<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Option Payoffs &amp; Strategies</title>
    <meta name="description" content="Build option strategies and see combined payoff diagrams. Interactive visualisation of spreads, straddles, and butterflies.">
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "LearningResource",
      "name": "Option Payoffs & Strategies",
      "url": "https://mathsedu.org/option_strategies.html",
      "description": "Build option strategies and see combined payoff diagrams. Interactive visualisation of spreads, straddles, and butterflies.",
      "educationalLevel": "Intermediate",
      "teaches": "Option payoff strategies",
      "learningResourceType": "Interactive visualisation",
      "interactivityType": "active",
      "inLanguage": "en",
      "isAccessibleForFree": true,
      "creator": {
        "@type": "Person",
        "name": "Manoj Bhaskar"
      },
      "license": "https://creativecommons.org/licenses/by-nc-sa/4.0/",
      "isPartOf": {
        "@type": "Course",
        "name": "Quantitative Finance",
        "url": "https://mathsedu.org/"
      }
    }
    </script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:#0a0a1a;color:#e0e0e0;font-family:Georgia,'Times New Roman',serif;line-height:1.6}
        .container{max-width:980px;margin:0 auto;padding:24px 28px 60px}
        .back{color:#606078;text-decoration:none;font-size:0.85em}
        .back:hover{color:#10b981}
        h1{font-size:1.85em;font-weight:400;color:#fff;margin:16px 0 4px;letter-spacing:-0.02em}
        .subtitle{color:#808098;font-style:italic;margin-bottom:30px}
        h2{font-size:1.13em;font-weight:400;color:#fff;margin:34px 0 12px;padding-bottom:6px;border-bottom:1px solid rgba(255,255,255,0.06)}
        canvas{display:block;border-radius:10px;border:1px solid rgba(255,255,255,0.06)}
        .panel{background:rgba(255,255,255,0.022);border:1px solid rgba(255,255,255,0.058);border-radius:10px;padding:18px 22px;margin-bottom:20px}
        .panel h3{font-weight:400;font-size:0.78em;color:#808098;text-transform:uppercase;letter-spacing:1.1px;margin-bottom:12px}
        .btn-row{display:flex;gap:7px;flex-wrap:wrap;margin-bottom:12px}
        .btn{background:rgba(255,255,255,0.032);border:1px solid rgba(255,255,255,0.07);color:#b0b0c4;padding:5px 12px;border-radius:6px;cursor:pointer;font-family:Georgia,serif;font-size:0.88em;transition:all 0.18s;-webkit-tap-highlight-color:transparent;white-space:nowrap}
        .btn:hover{background:rgba(255,255,255,0.07);color:#e0e0ef}
        .btn.active{background:rgba(16,185,129,0.13);border-color:rgba(16,185,129,0.38);color:#10b981}
        .btn.bull{background:rgba(16,185,129,0.06);border-color:rgba(16,185,129,0.22);color:#10b981}
        .btn.bull.active{background:rgba(16,185,129,0.18);border-color:rgba(16,185,129,0.55)}
        .btn.bear{background:rgba(248,113,113,0.06);border-color:rgba(248,113,113,0.22);color:#f87171}
        .btn.bear.active{background:rgba(248,113,113,0.18);border-color:rgba(248,113,113,0.55)}
        .btn.vol{background:rgba(251,191,36,0.06);border-color:rgba(251,191,36,0.22);color:#fbbf24}
        .btn.vol.active{background:rgba(251,191,36,0.18);border-color:rgba(251,191,36,0.55)}
        .btn.port{background:rgba(167,139,250,0.06);border-color:rgba(167,139,250,0.22);color:#a78bfa}
        .btn.port.active{background:rgba(167,139,250,0.18);border-color:rgba(167,139,250,0.55)}
        .math-line{font-family:'Courier New',monospace;font-size:0.9em;color:#c0c0d8;margin:3px 0;line-height:1.95}
        .green{color:#10b981}.cyan{color:#22d3ee}.gold{color:#fbbf24}.pink{color:#f472b6}
        .red{color:#f87171}.purple{color:#a78bfa}.muted{color:#808098}.white{color:#e0e0e0}
        .slider-row{display:flex;align-items:center;gap:14px;margin:8px 0}
        .slider-row label{color:#a0a0b8;font-size:0.88em;min-width:170px}
        .slider-row input[type=range]{flex:1;max-width:240px;accent-color:#10b981;cursor:pointer}
        .slider-val{color:#10b981;font-family:'Courier New',monospace;font-size:1.02em;min-width:62px;text-align:right}
        .result-box{background:rgba(16,185,129,0.05);border:1px solid rgba(16,185,129,0.18);border-radius:8px;padding:12px 18px;margin:12px 0}
        .stats-row{display:flex;gap:10px;flex-wrap:wrap}
        .stat-box{text-align:center;min-width:84px}
        .stat-label{font-size:0.68em;color:#707088;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:2px}
        .stat-val{font-family:'Courier New',monospace;font-size:0.97em}
        .insight-box{background:rgba(16,185,129,0.032);border-left:3px solid rgba(16,185,129,0.28);border-radius:0 8px 8px 0;padding:12px 16px;margin:14px 0;font-size:0.87em;color:#a0a0b8;line-height:1.76}
        .warn-box{background:rgba(251,191,36,0.028);border-left:3px solid rgba(251,191,36,0.28);border-radius:0 8px 8px 0;padding:12px 16px;margin:14px 0;font-size:0.87em;color:#a0a0b8;line-height:1.76}
        .red-box{background:rgba(248,113,113,0.028);border-left:3px solid rgba(248,113,113,0.28);border-radius:0 8px 8px 0;padding:12px 16px;margin:14px 0;font-size:0.87em;color:#a0a0b8;line-height:1.76}
        .formula-block{margin:8px 0;padding:10px 14px;background:rgba(255,255,255,0.018);border-radius:6px;font-family:'Courier New',monospace;font-size:0.9em;line-height:2.05}
        .two-col{display:grid;grid-template-columns:1fr 1fr;gap:16px}
        .three-col{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
        .mini-panel{background:rgba(255,255,255,0.015);border:1px solid rgba(255,255,255,0.05);border-radius:8px;padding:14px 16px}
        .mini-panel h4{font-weight:400;font-size:0.76em;color:#606078;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
        /* Greek badge pills */
        .greek-row{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
        .gbadge{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;border-radius:20px;font-size:0.8em;font-family:'Courier New',monospace;border:1px solid}
        .gbadge.up{background:rgba(16,185,129,0.10);border-color:rgba(16,185,129,0.35);color:#10b981}
        .gbadge.upup{background:rgba(16,185,129,0.20);border-color:rgba(16,185,129,0.55);color:#10b981;font-weight:bold}
        .gbadge.dn{background:rgba(248,113,113,0.10);border-color:rgba(248,113,113,0.35);color:#f87171}
        .gbadge.dndn{background:rgba(248,113,113,0.20);border-color:rgba(248,113,113,0.55);color:#f87171;font-weight:bold}
        .gbadge.neu{background:rgba(255,255,255,0.04);border-color:rgba(255,255,255,0.12);color:#808098}
        .gbadge.sm{background:rgba(255,255,255,0.04);border-color:rgba(255,255,255,0.10);color:#606070;font-size:0.74em}
        /* Classification grid */
        .class-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin:14px 0}
        .class-card{background:rgba(255,255,255,0.018);border:1px solid rgba(255,255,255,0.06);border-radius:8px;padding:12px 14px}
        .class-card h5{font-weight:400;font-size:0.76em;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
        .class-card ul{list-style:none;font-size:0.82em;color:#909098;line-height:1.7}
        .explain{background:rgba(255,255,255,0.022);border:1px solid rgba(255,255,255,0.058);border-radius:10px;padding:22px 26px;margin-top:20px}
        .explain-name{color:#10b981;font-size:1.1em;margin-bottom:8px}
        .explain-text{color:#a0a0b8;font-size:0.9em;line-height:1.82}
        .strategy-name{font-size:1.12em;color:#e0e0e0;font-weight:400;margin-bottom:4px}
        .strategy-desc{font-size:0.85em;color:#808098;font-style:italic;margin-bottom:12px}
        @media(max-width:640px){canvas{width:100%!important;height:auto!important}.slider-row{flex-wrap:wrap}.slider-row label{min-width:100%}.two-col,.three-col{grid-template-columns:1fr}.class-grid{grid-template-columns:1fr 1fr}}
    </style>
</head>
<body>
<div class="container">
    <a class="back" href="index.html">&larr; Back to Index</a>
    <h1>Option Payoffs &amp; Strategies</h1>
    <p class="subtitle">From primitives to portfolio architecture &mdash; payoff shapes, Greek signatures, and strategic classification</p>

    <!-- ═══════════════════════════════════════════════════════════════
         SECTION 1: Single-Leg Primitives
    ═══════════════════════════════════════════════════════════════ -->
    <h2>1. The Primitives &mdash; Single-Leg Positions</h2>
    <p style="color:#909098;font-size:0.9em;margin-bottom:16px">These are the atoms. Every multi-leg structure is Lego built from these four pieces.</p>

    <div class="panel">
        <div class="btn-row">
            <button class="btn bull active" id="btnLC">Long Call</button>
            <button class="btn bear" id="btnLP">Long Put</button>
            <button class="btn bear" id="btnSC">Short Call</button>
            <button class="btn bull" id="btnSP">Short Put</button>
        </div>
        <div id="singleName" class="strategy-name">Long Call</div>
        <div id="singleDesc" class="strategy-desc">You are buying asymmetry. Unlimited upside, premium is the maximum loss.</div>
        <div class="two-col" style="margin-top:12px">
            <div>
                <div style="font-size:0.75em;color:#606070;text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">Payoff at expiry</div>
                <canvas id="singlePayoff" width="430" height="260"></canvas>
            </div>
            <div>
                <div style="font-size:0.75em;color:#606070;text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">Greek profile vs spot</div>
                <canvas id="singleGreeks" width="430" height="260"></canvas>
            </div>
        </div>
        <div style="margin-top:14px">
            <div class="slider-row">
                <label>Strike K:</label>
                <input type="range" id="slK" min="70" max="130" value="100" step="1">
                <span class="slider-val" id="vslK">&pound;100</span>
            </div>
            <div class="slider-row">
                <label>Implied vol &sigma;:</label>
                <input type="range" id="slSig" min="5" max="60" value="20" step="1">
                <span class="slider-val" id="vslSig">20%</span>
            </div>
            <div class="slider-row">
                <label>Time to expiry T:</label>
                <input type="range" id="slT" min="1" max="24" value="3" step="1">
                <span class="slider-val" id="vslT">3 mo</span>
            </div>
        </div>
        <div id="singleGreekBadges" class="greek-row"></div>
        <div class="result-box">
            <div class="stats-row" id="singleStats"></div>
        </div>
        <div id="singleInsight" class="insight-box"></div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════
         SECTION 2: Directional Spreads
    ═══════════════════════════════════════════════════════════════ -->
    <h2>2. Directional Spreads &mdash; Engineering a Payoff Shape</h2>
    <p style="color:#909098;font-size:0.9em;margin-bottom:16px">Two-leg structures that sacrifice unlimited upside for capital efficiency and reduced premium cost.</p>

    <div class="panel">
        <div class="btn-row">
            <button class="btn bull active" id="btnBCS">Bull Call Spread</button>
            <button class="btn bear" id="btnBPS">Bear Put Spread</button>
            <button class="btn vol" id="btnRR">Risk Reversal</button>
        </div>
        <div id="spreadName" class="strategy-name">Bull Call Spread</div>
        <div id="spreadDesc" class="strategy-desc">Buy call at K1, sell call at K2. Moderately bullish. You sacrifice lottery-ticket upside for capital efficiency.</div>
        <div class="two-col" style="margin-top:12px">
            <div>
                <div style="font-size:0.75em;color:#606070;text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">Payoff at expiry</div>
                <canvas id="spreadPayoff" width="430" height="260"></canvas>
            </div>
            <div>
                <div style="font-size:0.75em;color:#606070;text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">Greek profile vs spot</div>
                <canvas id="spreadGreeks" width="430" height="260"></canvas>
            </div>
        </div>
        <div style="margin-top:14px">
            <div class="slider-row">
                <label>Lower strike K1:</label>
                <input type="range" id="spK1" min="70" max="110" value="95" step="1">
                <span class="slider-val" id="vspK1">&pound;95</span>
            </div>
            <div class="slider-row">
                <label>Upper strike K2:</label>
                <input type="range" id="spK2" min="90" max="140" value="110" step="1">
                <span class="slider-val" id="vspK2">&pound;110</span>
            </div>
            <div class="slider-row">
                <label>Implied vol &sigma;:</label>
                <input type="range" id="spSig" min="5" max="60" value="20" step="1">
                <span class="slider-val" id="vspSig">20%</span>
            </div>
            <div class="slider-row">
                <label>Time to expiry T:</label>
                <input type="range" id="spT" min="1" max="24" value="3" step="1">
                <span class="slider-val" id="vspT">3 mo</span>
            </div>
        </div>
        <div id="spreadGreekBadges" class="greek-row"></div>
        <div class="result-box">
            <div class="stats-row" id="spreadStats"></div>
        </div>
        <div id="spreadInsight" class="insight-box"></div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════
         SECTION 3: Volatility Structures
    ═══════════════════════════════════════════════════════════════ -->
    <h2>3. Volatility Structures &mdash; Trading Distribution Shape</h2>
    <p style="color:#909098;font-size:0.9em;margin-bottom:16px">These strategies trade the magnitude of moves rather than direction. You are long or short the <em>width</em> of the distribution.</p>

    <div class="panel">
        <div class="btn-row">
            <button class="btn vol active" id="btnStrad">Long Straddle</button>
            <button class="btn vol" id="btnStrang">Long Strangle</button>
            <button class="btn" id="btnSStrad">Short Straddle</button>
            <button class="btn vol" id="btnButt">Butterfly</button>
            <button class="btn" id="btnCondor">Iron Condor</button>
        </div>
        <div id="volName" class="strategy-name">Long Straddle</div>
        <div id="volDesc" class="strategy-desc">Buy ATM call + ATM put. Pure volatility bet. Theta will quietly eat you if nothing moves.</div>
        <div class="two-col" style="margin-top:12px">
            <div>
                <div style="font-size:0.75em;color:#606070;text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">Payoff at expiry</div>
                <canvas id="volPayoff" width="430" height="260"></canvas>
            </div>
            <div>
                <div style="font-size:0.75em;color:#606070;text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">Greek profile vs spot</div>
                <canvas id="volGreeks" width="430" height="260"></canvas>
            </div>
        </div>
        <div style="margin-top:14px">
            <div class="slider-row">
                <label>Centre strike K:</label>
                <input type="range" id="vlK" min="80" max="120" value="100" step="1">
                <span class="slider-val" id="vvlK">&pound;100</span>
            </div>
            <div class="slider-row">
                <label>Wing width (strang/butt):</label>
                <input type="range" id="vlWing" min="2" max="20" value="8" step="1">
                <span class="slider-val" id="vvlWing">&pound;8</span>
            </div>
            <div class="slider-row">
                <label>Implied vol &sigma;:</label>
                <input type="range" id="vlSig" min="5" max="60" value="20" step="1">
                <span class="slider-val" id="vvlSig">20%</span>
            </div>
            <div class="slider-row">
                <label>Time to expiry T:</label>
                <input type="range" id="vlT" min="1" max="24" value="3" step="1">
                <span class="slider-val" id="vvlT">3 mo</span>
            </div>
        </div>
        <div id="volGreekBadges" class="greek-row"></div>
        <div class="result-box">
            <div class="stats-row" id="volStats"></div>
        </div>
        <div id="volInsight" class="insight-box"></div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════
         SECTION 4: Portfolio Strategies
    ═══════════════════════════════════════════════════════════════ -->
    <h2>4. Portfolio Strategies &mdash; Options on Underlying Positions</h2>
    <p style="color:#909098;font-size:0.9em;margin-bottom:16px">These structures combine an option position with ownership of the underlying. This is where theory meets real portfolio management.</p>

    <div class="panel">
        <div class="btn-row">
            <button class="btn port active" id="btnCovCall">Covered Call</button>
            <button class="btn port" id="btnProtPut">Protective Put</button>
            <button class="btn port" id="btnCollar">Collar</button>
            <button class="btn port" id="btnSynLong">Synthetic Long</button>
        </div>
        <div id="portName" class="strategy-name">Covered Call</div>
        <div id="portDesc" class="strategy-desc">Long stock + short call. Income generation that caps upside. This is what people do when they want yield but also want to feel clever.</div>
        <div class="two-col" style="margin-top:12px">
            <div>
                <div style="font-size:0.75em;color:#606070;text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">Total position payoff</div>
                <canvas id="portPayoff" width="430" height="260"></canvas>
            </div>
            <div>
                <div style="font-size:0.75em;color:#606070;text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">Greek profile vs spot</div>
                <canvas id="portGreeks" width="430" height="260"></canvas>
            </div>
        </div>
        <div style="margin-top:14px">
            <div class="slider-row">
                <label>Stock price S:</label>
                <input type="range" id="ptS" min="80" max="120" value="100" step="1">
                <span class="slider-val" id="vptS">&pound;100</span>
            </div>
            <div class="slider-row">
                <label>Strike K:</label>
                <input type="range" id="ptK" min="80" max="130" value="105" step="1">
                <span class="slider-val" id="vptK">&pound;105</span>
            </div>
            <div class="slider-row">
                <label>Implied vol &sigma;:</label>
                <input type="range" id="ptSig" min="5" max="60" value="20" step="1">
                <span class="slider-val" id="vptSig">20%</span>
            </div>
            <div class="slider-row">
                <label>Time to expiry T:</label>
                <input type="range" id="ptT" min="1" max="24" value="3" step="1">
                <span class="slider-val" id="vptT">3 mo</span>
            </div>
        </div>
        <div id="portGreekBadges" class="greek-row"></div>
        <div class="result-box">
            <div class="stats-row" id="portStats"></div>
        </div>
        <div id="portInsight" class="insight-box"></div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════
         SECTION 5: Greek Classification Framework
    ═══════════════════════════════════════════════════════════════ -->
    <h2>5. The Greek Classification Framework</h2>
    <p style="color:#909098;font-size:0.9em;margin-bottom:16px">Forget product names. Every options portfolio can be classified by three axes. This is the real taxonomy.</p>

    <div class="panel">
        <h3>Classify by delta, gamma, and vega — not by product name</h3>
        <canvas id="greekClassCanvas" width="700" height="340"></canvas>

        <div class="class-grid" style="margin-top:18px">
            <div class="class-card" style="border-color:rgba(16,185,129,0.25)">
                <h5 style="color:#10b981">Directional</h5>
                <ul>
                    <li>Large &Delta;</li>
                    <li>Small &Gamma;</li>
                    <li>Limited &nu;</li>
                    <li style="margin-top:6px;color:#606070">Long call / put</li>
                    <li style="color:#606070">Spreads</li>
                    <li style="color:#606070">Risk reversals</li>
                </ul>
            </div>
            <div class="class-card" style="border-color:rgba(251,191,36,0.25)">
                <h5 style="color:#fbbf24">Long Volatility</h5>
                <ul>
                    <li>&Delta; &asymp; 0</li>
                    <li>+++ &Gamma;</li>
                    <li>+++ &nu;</li>
                    <li>&minus;&minus; &Theta;</li>
                    <li style="margin-top:6px;color:#606070">Long straddle</li>
                    <li style="color:#606070">Long strangle</li>
                    <li style="color:#606070">Long puts (hedge)</li>
                </ul>
            </div>
            <div class="class-card" style="border-color:rgba(248,113,113,0.25)">
                <h5 style="color:#f87171">Short Volatility</h5>
                <ul>
                    <li>&Delta; &asymp; 0</li>
                    <li>&minus;&minus;&minus; &Gamma;</li>
                    <li>&minus;&minus;&minus; &nu;</li>
                    <li>+++ &Theta;</li>
                    <li style="margin-top:6px;color:#606070">Short straddle</li>
                    <li style="color:#606070">Iron condor</li>
                    <li style="color:#606070">Covered call</li>
                </ul>
            </div>
            <div class="class-card" style="border-color:rgba(167,139,250,0.25)">
                <h5 style="color:#a78bfa">Yield Harvest</h5>
                <ul>
                    <li>&Delta; &gt; 0 (mild)</li>
                    <li>&minus; &Gamma;</li>
                    <li>&minus; &nu;</li>
                    <li>++ &Theta;</li>
                    <li style="margin-top:6px;color:#606070">Covered call</li>
                    <li style="color:#606070">Short put</li>
                    <li style="color:#606070">Collar</li>
                </ul>
            </div>
        </div>

        <div class="warn-box" style="margin-top:16px">
            <strong style="color:#fbbf24">The critical distinction:</strong> Long gamma &ne; always long vol profit. You only make money from long gamma if <strong>realised volatility exceeds implied volatility</strong>. A long straddle bought at 30% implied vol loses money if the market moves but realised vol is only 25%. That distinction separates traders from theorists.
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════
         SECTION 6: The Eight Questions
    ═══════════════════════════════════════════════════════════════ -->
    <h2>6. Eight Questions for Any Strategy</h2>
    <div class="panel">
        <h3>Interactive payoff analyser &mdash; select any strategy, answer all eight</h3>
        <div class="btn-row">
            <button class="btn bull active" id="qa0">Long Call</button>
            <button class="btn bear" id="qa1">Long Put</button>
            <button class="btn bear" id="qa2">Short Call</button>
            <button class="btn bull" id="qa3">Short Put</button>
            <button class="btn bull" id="qa4">Bull Call Spread</button>
            <button class="btn vol" id="qa5">Straddle</button>
            <button class="btn vol" id="qa6">Butterfly</button>
            <button class="btn port" id="qa7">Covered Call</button>
            <button class="btn port" id="qa8">Collar</button>
        </div>
        <canvas id="qaCanvas" width="700" height="310"></canvas>
        <div id="qaGrid" style="margin-top:14px"></div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════
         SECTION 7: The Mental Model
    ═══════════════════════════════════════════════════════════════ -->
    <h2>7. The Mental Model</h2>
    <div class="explain">
        <div class="explain-name">Three Axes. One Framework.</div>
        <div class="explain-text">
            Forget product names. Classify every options portfolio by three numbers:
            <br><br>
            <strong style="color:#e0e0e0">Net Delta (&Delta;) &rarr; Direction.</strong> If delta is large and non-zero, you have directional exposure. The position behaves roughly like owning &Delta; shares. A long ATM call with &Delta; = 0.5 on 100 contracts is equivalent to 50 shares of directional exposure.
            <br><br>
            <strong style="color:#e0e0e0">Net Gamma (&Gamma;) &rarr; Convexity.</strong> Positive gamma means your delta increases as the market rises and decreases as it falls &mdash; you are naturally repositioning in the right direction. Negative gamma means the opposite: you get longer as the market falls and shorter as it rises. Negative gamma positions require active hedging to avoid catastrophic loss in fast markets.
            <br><br>
            <strong style="color:#e0e0e0">Net Vega (&nu;) &rarr; Volatility regime.</strong> Positive vega means rising implied vol helps your position. Negative vega means you are selling insurance &mdash; you collect premium today but are exposed if the market reprices risk upward. Vega exposure is what separates options positions from equity positions: the same spot move can produce entirely different P&amp;L depending on what happens to implied vol simultaneously.
            <br><br>
            <strong style="color:#e0e0e0">The three canonical portfolios:</strong> If &Delta; &ne; 0 and &Gamma; is small &rarr; you are directional. If &Delta; &asymp; 0 and &Gamma; is positive &rarr; you are long volatility (long convexity). If &Delta; &asymp; 0 and &Gamma; is negative &rarr; you are short volatility (selling insurance). Everything else is implementation detail: the specific strikes, maturities, and structures you choose to express these three positions.
            <br><br>
            <strong style="color:#e0e0e0">Theta as the price of convexity.</strong> Long gamma always costs theta. Short gamma always earns theta. The ratio of gamma earned to theta paid &mdash; effectively how much the market needs to move daily to break even &mdash; is the central question in every options book. A position that earns &pound;1,000/day in theta needs realised vol to be lower than implied to be profitable. This is the fundamental P&amp;L equation of the vol business.
            <br><br>
            <strong style="color:#e0e0e0">Put-call parity runs the world quietly.</strong> Long call + short put at same strike = synthetic forward. Long put + long stock = synthetic call. These are not tricks &mdash; they are the arbitrage relationships that keep derivative prices consistent. Any apparent discrepancy is quickly eliminated by market participants, which is why the smile is a smooth surface rather than a collection of disconnected prices.
        </div>
    </div>
</div>

<script>
/* ══════════════════════════════════════════════════════════════════
   Option Payoffs & Strategies — full interactive page
   BS pricing, greek profiles, payoff diagrams for all strategies
   ══════════════════════════════════════════════════════════════════ */

/* ── Black-Scholes ── */
function normCDF(x){
    var a=[0.319381530,-0.356563782,1.781477937,-1.821255978,1.330274429];
    var k=1/(1+0.2316419*Math.abs(x));
    var p=k*(a[0]+k*(a[1]+k*(a[2]+k*(a[3]+k*a[4]))));
    var r=1-(1/Math.sqrt(2*Math.PI))*Math.exp(-x*x/2)*p;
    return x<0?1-r:r;
}
function normPDF(x){return Math.exp(-0.5*x*x)/Math.sqrt(2*Math.PI);}
function bsPrice(S,K,r,sig,T,isCall){
    if(T<=0) return isCall?Math.max(S-K,0):Math.max(K-S,0);
    var sqrtT=Math.sqrt(T);
    var d1=(Math.log(S/K)+(r+0.5*sig*sig)*T)/(sig*sqrtT);
    var d2=d1-sig*sqrtT;
    if(isCall) return S*normCDF(d1)-K*Math.exp(-r*T)*normCDF(d2);
    return K*Math.exp(-r*T)*normCDF(-d2)-S*normCDF(-d1);
}
function bsDelta(S,K,r,sig,T,isCall){
    if(T<=0) return isCall?(S>=K?1:0):(S<=K?-1:0);
    var d1=(Math.log(S/K)+(r+0.5*sig*sig)*T)/(sig*Math.sqrt(T));
    return isCall?normCDF(d1):normCDF(d1)-1;
}
function bsGamma(S,K,r,sig,T){
    if(T<=0) return 0;
    var d1=(Math.log(S/K)+(r+0.5*sig*sig)*T)/(sig*Math.sqrt(T));
    return normPDF(d1)/(S*sig*Math.sqrt(T));
}
function bsVega(S,K,r,sig,T){
    if(T<=0) return 0;
    var d1=(Math.log(S/K)+(r+0.5*sig*sig)*T)/(sig*Math.sqrt(T));
    return S*normPDF(d1)*Math.sqrt(T)/100; /* per 1% vol move */
}
function bsTheta(S,K,r,sig,T,isCall){
    if(T<=0) return 0;
    var sqrtT=Math.sqrt(T);
    var d1=(Math.log(S/K)+(r+0.5*sig*sig)*T)/(sig*sqrtT);
    var d2=d1-sig*sqrtT;
    var term1=-(S*normPDF(d1)*sig)/(2*sqrtT);
    if(isCall) return (term1-r*K*Math.exp(-r*T)*normCDF(d2))/365;
    return (term1+r*K*Math.exp(-r*T)*normCDF(-d2))/365;
}

var R=0.05; /* risk-free rate throughout */

function clearDark(cvs,ctx){
    ctx.clearRect(0,0,cvs.width,cvs.height);
    ctx.fillStyle='#0a0a1a';ctx.fillRect(0,0,cvs.width,cvs.height);
}

/* ─────────────────────────────────────────────────────────────────
   Universal payoff + greek canvas renderer
   legs: [{S:spot, K:strike, sig, T, isCall, qty}]   (qty: +1 or -1)
   stockQty: number of underlying shares (+1,-1,0)
   ───────────────────────────────────────────────────────────────── */
function drawPayoffCanvas(cvs, ctx, legs, stockQty, S0){
    var W=cvs.width, H=cvs.height;
    var PAD={l:54,r:18,t:22,b:38};
    var plotW=W-PAD.l-PAD.r, plotH=H-PAD.t-PAD.b;
    clearDark(cvs,ctx);

    var sMin=S0*0.55, sMax=S0*1.45;
    var sArr=[];
    for(var i=0;i<=200;i++) sArr.push(sMin+i/200*(sMax-sMin));

    /* Compute net premium paid */
    var premium=0;
    legs.forEach(function(l){premium+=l.qty*bsPrice(S0,l.K,R,l.sig,l.T,l.isCall);});
    var stockCost=stockQty*S0;

    /* Payoff at expiry (T=0) */
    var expPayoff=sArr.map(function(S){
        var p=0;
        legs.forEach(function(l){
            var intrinsic=l.isCall?Math.max(S-l.K,0):Math.max(l.K-S,0);
            p+=l.qty*(intrinsic-bsPrice(S0,l.K,R,l.sig,l.T,l.isCall));
        });
        p+=stockQty*(S-S0); /* stock P&L if held */
        return p;
    });

    /* Today's value */
    var todayVal=sArr.map(function(S){
        var p=0;
        legs.forEach(function(l){p+=l.qty*(bsPrice(S,l.K,R,l.sig,l.T,l.isCall)-bsPrice(S0,l.K,R,l.sig,l.T,l.isCall));});
        p+=stockQty*(S-S0);
        return p;
    });

    var allVals=expPayoff.concat(todayVal);
    var vMin=Math.min.apply(null,allVals);
    var vMax=Math.max.apply(null,allVals);
    var pad=(vMax-vMin)*0.15;
    vMin-=pad; vMax+=pad;
    if(vMin===vMax){vMin-=1;vMax+=1;}

    function tx(s){return PAD.l+(s-sMin)/(sMax-sMin)*plotW;}
    function ty(v){return PAD.t+plotH-(v-vMin)/(vMax-vMin)*plotH;}

    /* Grid */
    ctx.strokeStyle='rgba(255,255,255,0.03)'; ctx.lineWidth=1;
    for(var g=-4;g<=4;g++){
        var yv=(vMax+vMin)/2+g*(vMax-vMin)/8;
        if(yv<vMin||yv>vMax)continue;
        ctx.beginPath();ctx.moveTo(PAD.l,ty(yv));ctx.lineTo(W-PAD.r,ty(yv));ctx.stroke();
        ctx.fillStyle='#404058';ctx.font='9px Georgia';ctx.textAlign='right';ctx.textBaseline='middle';
        ctx.fillText((yv>=0?'+':'')+yv.toFixed(1),PAD.l-3,ty(yv));
    }
    /* Zero line */
    ctx.strokeStyle='rgba(255,255,255,0.12)';ctx.lineWidth=1;
    ctx.beginPath();ctx.moveTo(PAD.l,ty(0));ctx.lineTo(W-PAD.r,ty(0));ctx.stroke();
    ctx.fillStyle='#404058';ctx.font='9px Georgia';ctx.textAlign='right';ctx.textBaseline='middle';
    ctx.fillText('0',PAD.l-3,ty(0));

    /* Strike markers */
    legs.forEach(function(l){
        ctx.strokeStyle='rgba(255,255,255,0.08)';ctx.lineWidth=1;ctx.setLineDash([3,3]);
        ctx.beginPath();ctx.moveTo(tx(l.K),PAD.t);ctx.lineTo(tx(l.K),H-PAD.b);ctx.stroke();
        ctx.setLineDash([]);
        ctx.fillStyle='#505068';ctx.font='9px Georgia';ctx.textAlign='center';ctx.textBaseline='bottom';
        ctx.fillText('K='+(l.K>=100?'\u00A3':'\u00A3')+l.K,tx(l.K),PAD.t+12);
    });

    /* Today value (dashed cyan) */
    ctx.strokeStyle='rgba(34,211,238,0.50)';ctx.lineWidth=1.5;ctx.setLineDash([5,4]);
    ctx.beginPath();
    sArr.forEach(function(S,i){if(i===0)ctx.moveTo(tx(S),ty(todayVal[i]));else ctx.lineTo(tx(S),ty(todayVal[i]));});
    ctx.stroke();ctx.setLineDash([]);

    /* Fill pos / neg regions at expiry */
    ctx.beginPath();
    sArr.forEach(function(S,i){ctx.lineTo(tx(S),ty(Math.max(0,expPayoff[i])));});
    ctx.lineTo(W-PAD.r,ty(0));ctx.lineTo(PAD.l,ty(0));ctx.closePath();
    ctx.fillStyle='rgba(16,185,129,0.10)';ctx.fill();
    ctx.beginPath();
    sArr.forEach(function(S,i){ctx.lineTo(tx(S),ty(Math.min(0,expPayoff[i])));});
    ctx.lineTo(W-PAD.r,ty(0));ctx.lineTo(PAD.l,ty(0));ctx.closePath();
    ctx.fillStyle='rgba(248,113,113,0.10)';ctx.fill();

    /* Expiry payoff (solid green/red) */
    ctx.lineWidth=2.4;
    var prevPositive=expPayoff[0]>=0;
    for(var i=0;i<sArr.length;i++){
        var pos=expPayoff[i]>=0;
        if(i===0){ctx.beginPath();ctx.moveTo(tx(sArr[0]),ty(expPayoff[0]));}
        else if(pos!==prevPositive){
            /* Find zero crossing */
            ctx.strokeStyle=prevPositive?'rgba(16,185,129,0.88)':'rgba(248,113,113,0.88)';
            ctx.stroke();
            ctx.beginPath();ctx.moveTo(tx(sArr[i]),ty(expPayoff[i]));
        }else{
            ctx.lineTo(tx(sArr[i]),ty(expPayoff[i]));
        }
        prevPositive=pos;
        if(i===sArr.length-1){
            ctx.strokeStyle=pos?'rgba(16,185,129,0.88)':'rgba(248,113,113,0.88)';
            ctx.stroke();
        }
    }

    /* Spot marker */
    ctx.strokeStyle='rgba(251,191,36,0.50)';ctx.lineWidth=1;ctx.setLineDash([4,3]);
    ctx.beginPath();ctx.moveTo(tx(S0),PAD.t);ctx.lineTo(tx(S0),H-PAD.b);ctx.stroke();ctx.setLineDash([]);
    ctx.fillStyle='rgba(251,191,36,0.75)';ctx.font='9px Georgia';ctx.textAlign='center';ctx.textBaseline='bottom';
    ctx.fillText('S\u2080',tx(S0),H-PAD.b+14);

    /* Legend */
    ctx.fillStyle='rgba(16,185,129,0.75)';ctx.font='9px Georgia';ctx.textAlign='left';ctx.textBaseline='top';
    ctx.fillText('Expiry P&L',PAD.l+4,PAD.t+4);
    ctx.fillStyle='rgba(34,211,238,0.60)';
    ctx.fillText('Value today',PAD.l+4,PAD.t+15);

    /* Axis labels */
    ctx.fillStyle='#404058';ctx.font='10px Georgia';ctx.textAlign='center';ctx.textBaseline='top';
    ctx.fillText('Spot price at expiry',PAD.l+plotW/2,H-PAD.b+22);
    ctx.save();ctx.translate(12,PAD.t+plotH/2);ctx.rotate(-Math.PI/2);
    ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText('P&L (\u00A3)',0,0);ctx.restore();

    /* Breakevens */
    var bes=[];
    for(var i=1;i<sArr.length;i++){
        if(expPayoff[i-1]*expPayoff[i]<0){
            var be=sArr[i-1]+(sArr[i]-sArr[i-1])*(-expPayoff[i-1])/(expPayoff[i]-expPayoff[i-1]);
            bes.push(be);
            ctx.strokeStyle='rgba(255,255,255,0.30)';ctx.lineWidth=1;ctx.setLineDash([2,2]);
            ctx.beginPath();ctx.moveTo(tx(be),ty(0)-5);ctx.lineTo(tx(be),ty(0)+5);ctx.stroke();ctx.setLineDash([]);
        }
    }
    return {expPayoff, premium, bes, sArr};
}

/* ─────────────────────────────────────────────────────────────────
   Greek profile canvas
   ───────────────────────────────────────────────────────────────── */
function drawGreekCanvas(cvs, ctx, legs, stockQty, S0){
    var W=cvs.width, H=cvs.height;
    var PAD={l:54,r:22,t:22,b:38};
    var plotW=W-PAD.l-PAD.r, plotH=H-PAD.t-PAD.b;
    clearDark(cvs,ctx);

    var sMin=S0*0.60, sMax=S0*1.40;
    var sArr=[];
    for(var i=0;i<=150;i++) sArr.push(sMin+i/150*(sMax-sMin));

    function netGreek(S,type){
        var g=0;
        legs.forEach(function(l){
            if(type==='delta') g+=l.qty*bsDelta(S,l.K,R,l.sig,l.T,l.isCall);
            if(type==='gamma') g+=l.qty*bsGamma(S,l.K,R,l.sig,l.T);
            if(type==='vega')  g+=l.qty*bsVega(S,l.K,R,l.sig,l.T);
            if(type==='theta') g+=l.qty*bsTheta(S,l.K,R,l.sig,l.T,l.isCall);
        });
        if(type==='delta') g+=stockQty;
        return g;
    }

    var deltaArr=sArr.map(function(S){return netGreek(S,'delta');});
    var gammaArr=sArr.map(function(S){return netGreek(S,'gamma')*S;});/* scale for visibility */
    var vegaArr =sArr.map(function(S){return netGreek(S,'vega');});
    var thetaArr=sArr.map(function(S){return netGreek(S,'theta');});

    /* Normalise gammaArr to same scale as delta */
    var gMax=Math.max.apply(null,gammaArr.map(Math.abs));
    if(gMax>0) gammaArr=gammaArr.map(function(g){return g/gMax;});

    var dMax=Math.max.apply(null,deltaArr.map(Math.abs))||1;
    var vMax=Math.max.apply(null,vegaArr.map(Math.abs))||0.001;
    var tMax=Math.max.apply(null,thetaArr.map(Math.abs))||0.001;

    function tx(s){return PAD.l+(s-sMin)/(sMax-sMin)*plotW;}

    /* Draw each greek in a sub-strip */
    var strips=[
        {arr:deltaArr, scale:dMax, label:'\u0394 Delta', colour:'rgba(16,185,129,0.85)'},
        {arr:gammaArr, scale:1,    label:'\u0393 Gamma (scaled)', colour:'rgba(34,211,238,0.80)'},
        {arr:vegaArr,  scale:vMax, label:'\u03BD Vega', colour:'rgba(251,191,36,0.80)'},
        {arr:thetaArr, scale:tMax, label:'\u0398 Theta', colour:'rgba(248,113,113,0.75)'},
    ];
    var nS=strips.length;
    var sH=(plotH-nS*6)/nS;

    strips.forEach(function(strip,si){
        var yTop=PAD.t+si*(sH+6);
        var yBot=yTop+sH;
        var yMid=(yTop+yBot)/2;
        var sc=strip.scale||1;

        function ty(v){return yMid-(v/sc)*(sH/2)*0.88;}

        /* Strip bg */
        ctx.fillStyle='rgba(255,255,255,0.012)';
        ctx.fillRect(PAD.l,yTop,plotW,sH);

        /* Zero line */
        ctx.strokeStyle='rgba(255,255,255,0.10)';ctx.lineWidth=1;
        ctx.beginPath();ctx.moveTo(PAD.l,yMid);ctx.lineTo(W-PAD.r,yMid);ctx.stroke();

        /* Positive fill */
        ctx.beginPath();
        sArr.forEach(function(S,i){ctx.lineTo(tx(S),ty(Math.max(0,strip.arr[i])));});
        ctx.lineTo(W-PAD.r,yMid);ctx.lineTo(PAD.l,yMid);ctx.closePath();
        var pos_col=strip.colour.replace('0.85','0.10').replace('0.80','0.10').replace('0.75','0.10');
        ctx.fillStyle=pos_col;ctx.fill();

        /* Negative fill */
        ctx.beginPath();
        sArr.forEach(function(S,i){ctx.lineTo(tx(S),ty(Math.min(0,strip.arr[i])));});
        ctx.lineTo(W-PAD.r,yMid);ctx.lineTo(PAD.l,yMid);ctx.closePath();
        ctx.fillStyle='rgba(248,113,113,0.07)';ctx.fill();

        /* Line */
        ctx.strokeStyle=strip.colour;ctx.lineWidth=1.8;
        ctx.beginPath();
        sArr.forEach(function(S,i){if(i===0)ctx.moveTo(tx(S),ty(strip.arr[i]));else ctx.lineTo(tx(S),ty(strip.arr[i]));});
        ctx.stroke();

        /* Label */
        ctx.fillStyle=strip.colour;ctx.font='9px Georgia';ctx.textAlign='left';ctx.textBaseline='top';
        ctx.fillText(strip.label,PAD.l+3,yTop+2);

        /* Spot marker */
        ctx.strokeStyle='rgba(251,191,36,0.35)';ctx.lineWidth=1;ctx.setLineDash([3,3]);
        ctx.beginPath();ctx.moveTo(tx(S0),yTop);ctx.lineTo(tx(S0),yBot);ctx.stroke();ctx.setLineDash([]);

        /* Strike markers */
        legs.forEach(function(l){
            ctx.strokeStyle='rgba(255,255,255,0.06)';ctx.lineWidth=1;ctx.setLineDash([2,3]);
            ctx.beginPath();ctx.moveTo(tx(l.K),yTop);ctx.lineTo(tx(l.K),yBot);ctx.stroke();ctx.setLineDash([]);
        });

        /* Value at spot */
        var valAtSpot=strip.arr[Math.round((S0-sMin)/(sMax-sMin)*150)];
        ctx.fillStyle=valAtSpot===undefined?'#606070':(Math.abs((valAtSpot||0)/sc)<0.001?'#606070':(valAtSpot>0?'rgba(16,185,129,0.85)':'rgba(248,113,113,0.85)'));
        var valStr=(valAtSpot!==undefined&&sc!==1)?(valAtSpot>=0?'+':'')+valAtSpot.toFixed(3):'';
        if(si===0) valStr=(strip.arr[75]>=0?'+':'')+strip.arr[75].toFixed(3);
        ctx.font='8px Georgia';ctx.textAlign='right';ctx.textBaseline='middle';
        ctx.fillText('@S\u2080',W-PAD.r,yMid);
    });

    ctx.fillStyle='#404058';ctx.font='10px Georgia';ctx.textAlign='center';ctx.textBaseline='top';
    ctx.fillText('Spot price',PAD.l+plotW/2,PAD.t+plotH+6);
}

/* ─────────────────────────────────────────────────────────────────
   Greek badge builder
   ───────────────────────────────────────────────────────────────── */
function greekBadges(delta,gamma,vega,theta){
    function sign(v,name){
        var abs=Math.abs(v);
        var cls=v>0.05?'up':(v>0.01?'up':(v<-0.05?'dn':(v<-0.01?'dn':'neu')));
        if(abs>0.50 && v>0) cls='upup';
        if(abs>0.50 && v<0) cls='dndn';
        var sym=v>0.05?'+':(v<-0.05?'\u2212':'~');
        return '<span class="gbadge '+cls+'">'+sym+sym[0]!=='~'?sym:'' +name+'</span>';
    }
    function badge(label,val,big){
        var cls;
        if(big){cls=val>0.1?'upup':val>0.02?'up':val<-0.1?'dndn':val<-0.02?'dn':'neu';}
        else{cls=val>0.02?'up':val<-0.02?'dn':'neu';}
        var sym=val>0.02?(big?'++':'+'):(val<-0.02?(big?'\u2212\u2212':'\u2212'):'~');
        return '<span class="gbadge '+cls+'">'+sym+' '+label+'</span>';
    }
    return badge('\u0394 Delta',delta,Math.abs(delta)>0.3)+
           badge('\u0393 Gamma',gamma,Math.abs(gamma*100)>0.5)+
           badge('\u03BD Vega',vega,Math.abs(vega)>0.05)+
           badge('\u0398 Theta',theta,Math.abs(theta)>0.01);
}

/* ═══════════════════════════════════════════════════
   SECTION 1: Single-Leg state & draw
═══════════════════════════════════════════════════ */
var slType='lc'; /* lc, lp, sc, sp */
var slCvs=document.getElementById('singlePayoff'),slCtx=slCvs.getContext('2d');
var slGCvs=document.getElementById('singleGreeks'),slGCtx=slGCvs.getContext('2d');

var slData={
    lc:{name:'Long Call',desc:'You are buying asymmetry. Unlimited upside; the premium is the maximum you can lose. Benefit from price rises, vol expansion, and convexity. Bleed theta daily.',isCall:true,qty:1,insight:'Long call is the purest expression of bullish conviction with convexity. Delta starts near 0.5 ATM and rises toward 1.0 deep ITM. Gamma is highest ATM — this is where you get the most convexity per pound of premium. Vega is positive: rising implied vol increases the value of your option even if spot hasn\'t moved. Theta is always negative: time decay is the cost of holding convexity.'},
    lp:{name:'Long Put',desc:'Insurance against stupidity — or your own portfolio. Bearish with convexity. Same Greek profile as a long call except delta flips negative.',isCall:false,qty:1,insight:'Long put mirrors a long call in structure but direction. Delta is negative (more negative deep ITM). Gamma remains positive — you still own convexity. This is why long puts are valuable tail hedges: a crash that also spikes vol gives you a double benefit (intrinsic value rises AND vol markup). Theta bleeds relentlessly, which is why expensive insurance must be sized carefully.'},
    sc:{name:'Short Call',desc:'You collect pennies in front of a freight train. Premium is your maximum gain; losses are theoretically unlimited to the upside.',isCall:true,qty:-1,insight:'Short call is the exact mirror of long call. You collect the premium upfront but accept unlimited upside risk. Delta is negative — a rising spot hurts you. Gamma is negative — convexity works against you. Vega is negative — a vol spike immediately harms your position. Theta is positive: time decay works in your favour. The short call is the canonical short-vol, short-gamma, theta-harvesting position.'},
    sp:{name:'Short Put',desc:'Getting paid to catch a falling knife. You are paid to agree to buy the underlying at the strike. Bullish view with capped income.',isCall:false,qty:-1,insight:'Short put collects premium in exchange for bearing downside risk below the strike. Delta is positive (you benefit if spot rises). Gamma is negative. Vega negative — rising vol hurts. Theta positive — time decay benefits you. Short puts are widely used as a way to get paid to acquire stock at a lower level; many systematic yield strategies are built on selling puts at technically significant levels.'}
};

function drawSingle(){
    var K=parseInt(document.getElementById('slK').value);
    var sig=parseInt(document.getElementById('slSig').value)/100;
    var T=parseInt(document.getElementById('slT').value)/12;
    var S0=100;
    document.getElementById('vslK').textContent='\u00A3'+K;
    document.getElementById('vslSig').textContent=(sig*100).toFixed(0)+'%';
    document.getElementById('vslT').textContent=parseInt(document.getElementById('slT').value)+' mo';

    var d=slData[slType];
    document.getElementById('singleName').textContent=d.name;
    document.getElementById('singleDesc').textContent=d.desc;
    document.getElementById('singleInsight').innerHTML=d.insight;

    var legs=[{K:K,sig:sig,T:T,isCall:d.isCall,qty:d.qty}];
    var r=drawPayoffCanvas(slCvs,slCtx,legs,0,S0);
    drawGreekCanvas(slGCvs,slGCtx,legs,0,S0);

    var delta=d.qty*bsDelta(S0,K,R,sig,T,d.isCall);
    var gamma=d.qty*bsGamma(S0,K,R,sig,T);
    var vega =d.qty*bsVega(S0,K,R,sig,T);
    var theta=d.qty*bsTheta(S0,K,R,sig,T,d.isCall);
    document.getElementById('singleGreekBadges').innerHTML=greekBadges(delta,gamma,vega,theta);

    var prem=bsPrice(S0,K,R,sig,T,d.isCall);
    var maxGain=d.qty===1?(d.isCall?'Unlimited':'\u00A3'+(K-prem*d.qty).toFixed(2)):'\u00A3'+prem.toFixed(2);
    var maxLoss=d.qty===1?'\u00A3'+prem.toFixed(2):(d.isCall?'Unlimited':'\u00A3'+(K-prem).toFixed(2));
    var be=d.qty===1?(d.isCall?K+prem:K-prem):(d.isCall?K+prem:K-prem);
    document.getElementById('singleStats').innerHTML=
        '<div class="stat-box"><div class="stat-label">Premium</div><div class="stat-val gold">\u00A3'+prem.toFixed(2)+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">Max gain</div><div class="stat-val green">'+maxGain+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">Max loss</div><div class="stat-val red">'+maxLoss+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">Breakeven</div><div class="stat-val">\u00A3'+be.toFixed(2)+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">&Delta; Delta</div><div class="stat-val '+(delta>0?'green':'red')+'">'+(delta>=0?'+':'')+delta.toFixed(3)+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">&Gamma; Gamma</div><div class="stat-val '+(gamma>0?'green':'red')+'">'+(gamma>=0?'+':'')+gamma.toFixed(4)+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">&nu; Vega</div><div class="stat-val '+(vega>0?'green':'red')+'">'+(vega>=0?'+':'')+vega.toFixed(3)+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">&Theta; Theta/day</div><div class="stat-val '+(theta>0?'green':'red')+'">'+(theta>=0?'+':'')+theta.toFixed(3)+'</div></div>';
}

['btnLC','btnLP','btnSC','btnSP'].forEach(function(id){
    document.getElementById(id).addEventListener('click',function(){
        slType=id==='btnLC'?'lc':id==='btnLP'?'lp':id==='btnSC'?'sc':'sp';
        ['btnLC','btnLP','btnSC','btnSP'].forEach(function(b){document.getElementById(b).classList.toggle('active',b===id);});
        drawSingle();
    });
});
['slK','slSig','slT'].forEach(function(id){document.getElementById(id).addEventListener('input',drawSingle);});

/* ═══════════════════════════════════════════════════
   SECTION 2: Directional Spreads
═══════════════════════════════════════════════════ */
var spType='bcs';
var spCvs=document.getElementById('spreadPayoff'),spCtx=spCvs.getContext('2d');
var spGCvs=document.getElementById('spreadGreeks'),spGCtx=spGCvs.getContext('2d');

var spData={
    bcs:{name:'Bull Call Spread',desc:'Buy call at K1, sell call at K2. Moderately bullish. You sacrifice lottery-ticket upside for capital efficiency — adult behaviour.',insight:'The bull call spread reduces premium cost by selling an OTM call, but caps the maximum gain at K2−K1 minus net premium. Net delta is positive but smaller than a naked long call. Gamma is positive near K1 (where you are long) and negative near K2 (where you are short). This creates a gamma hump between the strikes. Vega is positive but reduced — you do not need as large a vol expansion to profit. Maximum profit is achieved if spot finishes at or above K2.'},
    bps:{name:'Bear Put Spread',desc:'Buy put at K2, sell put at K1. Moderately bearish with limited cost and capped profit.',insight:'The bear put spread is the directional inverse of the bull call spread. Buy the higher-strike put, sell the lower-strike put to reduce cost. Net delta is negative. Gamma is concentrated between the two strikes. Maximum profit if spot finishes at or below K1. The spread structure makes this a practical hedging tool: you reduce the cost of put protection by giving up extreme downside profit. Used extensively in portfolio hedging where extreme crash profits are less important than cost reduction.'},
    rr:{name:'Risk Reversal',desc:'Long call at K2, short put at K1. Synthetic long forward tilt. This is how you express conviction without pretending you are hedged.',insight:'The risk reversal (long call, short put) is close to a synthetic forward when the strikes are equal. With different strikes, you get strong positive delta with relatively small gamma and vega — this is a directional skew trade. You finance the call by selling downside protection. Used by institutions to express strong bullish conviction. The skew in FX markets means risk reversals have a non-zero net premium depending on which leg is more expensive due to smile asymmetry.'}
};

function drawSpread(){
    var K1=parseInt(document.getElementById('spK1').value);
    var K2=parseInt(document.getElementById('spK2').value);
    if(K2<=K1){K2=K1+5; document.getElementById('spK2').value=K2;}
    var sig=parseInt(document.getElementById('spSig').value)/100;
    var T=parseInt(document.getElementById('spT').value)/12;
    var S0=100;
    document.getElementById('vspK1').textContent='\u00A3'+K1;
    document.getElementById('vspK2').textContent='\u00A3'+K2;
    document.getElementById('vspSig').textContent=(sig*100).toFixed(0)+'%';
    document.getElementById('vspT').textContent=parseInt(document.getElementById('spT').value)+' mo';

    var d=spData[spType];
    document.getElementById('spreadName').textContent=d.name;
    document.getElementById('spreadDesc').textContent=d.desc;
    document.getElementById('spreadInsight').innerHTML=d.insight;

    var legs;
    if(spType==='bcs'){
        legs=[{K:K1,sig:sig,T:T,isCall:true,qty:1},{K:K2,sig:sig,T:T,isCall:true,qty:-1}];
    }else if(spType==='bps'){
        legs=[{K:K2,sig:sig,T:T,isCall:false,qty:1},{K:K1,sig:sig,T:T,isCall:false,qty:-1}];
    }else{
        /* risk reversal: long call K2, short put K1 */
        legs=[{K:K2,sig:sig,T:T,isCall:true,qty:1},{K:K1,sig:sig,T:T,isCall:false,qty:-1}];
    }
    drawPayoffCanvas(spCvs,spCtx,legs,0,S0);
    drawGreekCanvas(spGCvs,spGCtx,legs,0,S0);

    var delta=legs.reduce(function(s,l){return s+l.qty*bsDelta(S0,l.K,R,sig,T,l.isCall);},0);
    var gamma=legs.reduce(function(s,l){return s+l.qty*bsGamma(S0,l.K,R,sig,T);},0);
    var vega =legs.reduce(function(s,l){return s+l.qty*bsVega(S0,l.K,R,sig,T);},0);
    var theta=legs.reduce(function(s,l){return s+l.qty*bsTheta(S0,l.K,R,sig,T,l.isCall);},0);
    var prem =legs.reduce(function(s,l){return s+l.qty*bsPrice(S0,l.K,R,sig,T,l.isCall);},0);
    document.getElementById('spreadGreekBadges').innerHTML=greekBadges(delta,gamma,vega,theta);

    var maxG=spType==='rr'?'Unlimited':'\u00A3'+(K2-K1-Math.max(0,prem)).toFixed(2);
    var maxL=spType==='rr'?'\u00A3'+(K2-K1-Math.max(0,-prem)).toFixed(2):'\u00A3'+Math.max(0,prem).toFixed(2);
    document.getElementById('spreadStats').innerHTML=
        '<div class="stat-box"><div class="stat-label">Net premium</div><div class="stat-val '+(prem<0?'green':'gold')+'">'+(prem>=0?'\u2212':'+')+(Math.abs(prem)).toFixed(2)+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">Max gain</div><div class="stat-val green">'+maxG+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">Max loss</div><div class="stat-val red">'+maxL+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">Width K2\u2212K1</div><div class="stat-val">\u00A3'+(K2-K1)+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">&Delta;</div><div class="stat-val '+(delta>0?'green':'red')+'">'+(delta>=0?'+':'')+delta.toFixed(3)+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">&Gamma;</div><div class="stat-val '+(gamma>0?'green':'red')+'">'+(gamma>=0?'+':'')+gamma.toFixed(4)+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">&nu;</div><div class="stat-val '+(vega>0?'green':'red')+'">'+(vega>=0?'+':'')+vega.toFixed(3)+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">&Theta;/day</div><div class="stat-val '+(theta>0?'green':'red')+'">'+(theta>=0?'+':'')+theta.toFixed(3)+'</div></div>';
}

['btnBCS','btnBPS','btnRR'].forEach(function(id){
    document.getElementById(id).addEventListener('click',function(){
        spType=id==='btnBCS'?'bcs':id==='btnBPS'?'bps':'rr';
        ['btnBCS','btnBPS','btnRR'].forEach(function(b){document.getElementById(b).classList.toggle('active',b===id);});
        drawSpread();
    });
});
['spK1','spK2','spSig','spT'].forEach(function(id){document.getElementById(id).addEventListener('input',drawSpread);});

/* ═══════════════════════════════════════════════════
   SECTION 3: Vol Structures
═══════════════════════════════════════════════════ */
var vlType='strad';
var vlCvs=document.getElementById('volPayoff'),vlCtx=vlCvs.getContext('2d');
var vlGCvs=document.getElementById('volGreeks'),vlGCtx=vlGCvs.getContext('2d');

var vlData={
    strad:{name:'Long Straddle',desc:'Buy ATM call + ATM put at same strike. Pure volatility bet. You profit from a large move in either direction; theta bleeds daily if nothing happens.',insight:'The straddle is the purest long-vol structure: delta starts near zero (call delta ~+0.5 offsets put delta ~−0.5), gamma is very high ATM, vega is double that of a single option, theta is double the bleed. The key break-even calculation: the spot must move more than the total premium paid (in either direction) for the trade to be profitable at expiry. Used before binary events: earnings, central bank decisions, economic data releases. The risk is paying 25 vol for a world that moves at 18 vol.'},
    strang:{name:'Long Strangle',desc:'Buy OTM call + OTM put. Cheaper than a straddle — same vol bet, just needs a bigger move to profit.',insight:'The strangle reduces premium by using OTM strikes. This lowers gamma ATM but widens the region over which the position profits. Lower upfront cost means lower breakevens on a percentage basis despite needing a larger absolute move. Gamma is concentrated at the two strikes rather than one central point. Useful when you expect a large move but are uncertain if the event is large enough to justify the full straddle cost. The strangle gives you the same directional optionality with lower theta bleed per day.'},
    sstrad:{name:'Short Straddle',desc:'Sell both call and put at the same strike. Profit if market stays calm. Risk if the market remembers that chaos exists.',insight:'The short straddle is short convexity in its rawest form. You collect maximum premium (both call and put) and profit if spot stays near the strike until expiry. Delta is near zero initially, gamma strongly negative, vega strongly negative, theta strongly positive — the insurance company business model. The position is extremely sensitive to sudden moves: a large gap can produce catastrophic losses. Risk is typically managed with delta hedging and hard stop-losses. The short straddle is the preferred structure for selling vol before quiet periods.'},
    butt:{name:'Long Butterfly',desc:'Buy 1 low call, sell 2 mid calls, buy 1 high call. Limited risk and reward. Profits if price pins near the centre strike.',insight:'The butterfly is a precision instrument. It is structurally long vol (you own the wings) but short the middle body. Near the centre strike it behaves like a short straddle (negative gamma, positive theta); in the wings it behaves like long options. Net vega is typically small or mildly negative. Maximum profit if spot expires exactly at the middle strike. Used to express a pinning view — that the market will stay range-bound near a specific level. The limited risk (maximum loss is the net premium paid) makes it safer than a short straddle.'},
    condor:{name:'Iron Condor',desc:'Sell OTM call spread + sell OTM put spread. Premium harvesting with guardrails. Civilization\'s version of a casino.',insight:'The iron condor is four-legged short vol with capped tails. You profit if spot stays between the inner strikes; your maximum loss is the width of one spread minus the premium received. Delta is near zero. Gamma and vega are negative. Theta is positive. The iron condor is the structured vol-selling product: you give up unlimited short-straddle profits but cap the maximum loss. Maximum profit is the total net premium received, achieved if both short legs expire worthless. Used extensively in systematic income strategies in stable market environments.'}
};

function drawVol(){
    var K=parseInt(document.getElementById('vlK').value);
    var wing=parseInt(document.getElementById('vlWing').value);
    var sig=parseInt(document.getElementById('vlSig').value)/100;
    var T=parseInt(document.getElementById('vlT').value)/12;
    var S0=100;
    document.getElementById('vvlK').textContent='\u00A3'+K;
    document.getElementById('vvlWing').textContent='\u00A3'+wing;
    document.getElementById('vvlSig').textContent=(sig*100).toFixed(0)+'%';
    document.getElementById('vvlT').textContent=parseInt(document.getElementById('vlT').value)+' mo';

    var d=vlData[vlType];
    document.getElementById('volName').textContent=d.name;
    document.getElementById('volDesc').textContent=d.desc;
    document.getElementById('volInsight').innerHTML=d.insight;

    var legs;
    var Kl=K-wing, Ku=K+wing;
    if(vlType==='strad'){
        legs=[{K:K,sig:sig,T:T,isCall:true,qty:1},{K:K,sig:sig,T:T,isCall:false,qty:1}];
    }else if(vlType==='strang'){
        legs=[{K:Ku,sig:sig,T:T,isCall:true,qty:1},{K:Kl,sig:sig,T:T,isCall:false,qty:1}];
    }else if(vlType==='sstrad'){
        legs=[{K:K,sig:sig,T:T,isCall:true,qty:-1},{K:K,sig:sig,T:T,isCall:false,qty:-1}];
    }else if(vlType==='butt'){
        /* Long 1 lower, short 2 mid, long 1 upper */
        legs=[{K:Kl,sig:sig,T:T,isCall:true,qty:1},{K:K,sig:sig,T:T,isCall:true,qty:-2},{K:Ku,sig:sig,T:T,isCall:true,qty:1}];
    }else{
        /* Iron condor: sell OTM call spread (K, K+wing), sell OTM put spread (K-wing, K) */
        var w2=Math.max(2,Math.round(wing/2));
        legs=[
            {K:K+w2,sig:sig,T:T,isCall:true,qty:-1},{K:K+wing,sig:sig,T:T,isCall:true,qty:1},
            {K:K-w2,sig:sig,T:T,isCall:false,qty:-1},{K:K-wing,sig:sig,T:T,isCall:false,qty:1}
        ];
    }

    drawPayoffCanvas(vlCvs,vlCtx,legs,0,S0);
    drawGreekCanvas(vlGCvs,vlGCtx,legs,0,S0);

    var delta=legs.reduce(function(s,l){return s+l.qty*bsDelta(S0,l.K,R,sig,T,l.isCall);},0);
    var gamma=legs.reduce(function(s,l){return s+l.qty*bsGamma(S0,l.K,R,sig,T);},0);
    var vega =legs.reduce(function(s,l){return s+l.qty*bsVega(S0,l.K,R,sig,T);},0);
    var theta=legs.reduce(function(s,l){return s+l.qty*bsTheta(S0,l.K,R,sig,T,l.isCall);},0);
    var prem =legs.reduce(function(s,l){return s+l.qty*bsPrice(S0,l.K,R,sig,T,l.isCall);},0);
    document.getElementById('volGreekBadges').innerHTML=greekBadges(delta,gamma,vega,theta);
    document.getElementById('volStats').innerHTML=
        '<div class="stat-box"><div class="stat-label">Net premium</div><div class="stat-val '+(prem<0?'green':'gold')+'">'+(prem>=0?'\u2212':'+')+(Math.abs(prem)).toFixed(2)+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">Centre K</div><div class="stat-val">\u00A3'+K+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">&Delta;</div><div class="stat-val '+(delta>0?'green':'red')+'">'+(delta>=0?'+':'')+delta.toFixed(3)+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">&Gamma;</div><div class="stat-val '+(gamma>0?'green':'red')+'">'+(gamma>=0?'+':'')+gamma.toFixed(4)+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">&nu;</div><div class="stat-val '+(vega>0?'green':'red')+'">'+(vega>=0?'+':'')+vega.toFixed(3)+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">&Theta;/day</div><div class="stat-val '+(theta>0?'green':'red')+'">'+(theta>=0?'+':'')+theta.toFixed(3)+'</div></div>';
}

['btnStrad','btnStrang','btnSStrad','btnButt','btnCondor'].forEach(function(id){
    document.getElementById(id).addEventListener('click',function(){
        vlType=id==='btnStrad'?'strad':id==='btnStrang'?'strang':id==='btnSStrad'?'sstrad':id==='btnButt'?'butt':'condor';
        ['btnStrad','btnStrang','btnSStrad','btnButt','btnCondor'].forEach(function(b){document.getElementById(b).classList.toggle('active',b===id);});
        drawVol();
    });
});
['vlK','vlWing','vlSig','vlT'].forEach(function(id){document.getElementById(id).addEventListener('input',drawVol);});

/* ═══════════════════════════════════════════════════
   SECTION 4: Portfolio Strategies
═══════════════════════════════════════════════════ */
var ptType='cc';
var ptCvs=document.getElementById('portPayoff'),ptCtx=ptCvs.getContext('2d');
var ptGCvs=document.getElementById('portGreeks'),ptGCtx=ptGCvs.getContext('2d');

var ptData={
    cc:{name:'Covered Call',desc:'Long 100 shares + short 1 call. Income generation that caps upside. You sacrifice potential rally gains in exchange for certain premium income.',insight:'The covered call caps your upside at K plus the premium received. Your effective selling price if called away is K + premium. Below the strike, you still own the stock and absorb losses just like any stock holder, offset only by the premium received. Delta is positive but less than 1 (you are short some call delta). Gamma negative. Vega negative. Theta positive — time decay works in your favour. The covered call is the most popular structured yield strategy; it performs well in sideways to mildly bullish markets and underperforms in sharp rallies.'},
    pp:{name:'Protective Put',desc:'Long 100 shares + long 1 put. Portfolio insurance. Floors your downside at K minus premium paid.',insight:'The protective put establishes a floor: no matter how far the stock falls, your maximum loss is (S0 − K + premium). Above the strike, the put expires worthless and you simply own the stock with premium as an additional cost. Net delta is positive but less than 1 (the put contributes negative delta). Gamma is positive (long put adds convexity). Vega is positive — a volatility spike increases the put value. This is the classic institutional hedge during earnings or macro uncertainty. The cost (premium) can be reduced by selling an OTM call (creating a collar).'},
    col:{name:'Collar',desc:'Long stock + long put (floor) + short call (cap). Downside protected, upside capped, cost reduced. This is how CIOs sleep at night.',insight:'The collar combines a protective put with a covered call. The premium received from the short call offsets (partially or fully) the cost of the protective put. You give up upside beyond the call strike to fund downside protection below the put strike. Net delta is positive but bounded. Gamma can be near zero between the strikes (the two legs offset). This is the canonical institutional hedging structure: preserve equity upside up to a point, eliminate downside risk below a floor, and minimise net cost. Zero-cost collars (where premium from short call exactly offsets put cost) are common in executive compensation hedging.'},
    syn:{name:'Synthetic Long',desc:'Long call + short put at same strike. Identical payoff to owning the stock, but no upfront capital for the stock itself.',insight:'By put-call parity, long call + short put at the same strike = synthetic long forward. The payoff is exactly linear — identical to holding the underlying stock from that strike level. Delta is approximately 1. Gamma near zero (long call gamma offsets short put gamma). Vega near zero (same reason). Theta near zero. The synthetic long demonstrates put-call parity in its purest form: the combination of options perfectly replicates equity ownership. Institutions use synthetic positions to gain exposure without settlement constraints, or to express a directional view through options when stock borrowing is expensive.'}
};

function drawPort(){
    var S0=parseInt(document.getElementById('ptS').value);
    var K=parseInt(document.getElementById('ptK').value);
    var sig=parseInt(document.getElementById('ptSig').value)/100;
    var T=parseInt(document.getElementById('ptT').value)/12;
    document.getElementById('vptS').textContent='\u00A3'+S0;
    document.getElementById('vptK').textContent='\u00A3'+K;
    document.getElementById('vptSig').textContent=(sig*100).toFixed(0)+'%';
    document.getElementById('vptT').textContent=parseInt(document.getElementById('ptT').value)+' mo';

    var d=ptData[ptType];
    document.getElementById('portName').textContent=d.name;
    document.getElementById('portDesc').textContent=d.desc;
    document.getElementById('portInsight').innerHTML=d.insight;

    var legs; var stockQty=0;
    var K2=Math.round(S0*0.93); /* put strike for collar ~7% OTM */
    if(ptType==='cc'){
        legs=[{K:K,sig:sig,T:T,isCall:true,qty:-1}]; stockQty=1;
    }else if(ptType==='pp'){
        legs=[{K:K,sig:sig,T:T,isCall:false,qty:1}]; stockQty=1;
    }else if(ptType==='col'){
        legs=[{K:K2,sig:sig,T:T,isCall:false,qty:1},{K:K,sig:sig,T:T,isCall:true,qty:-1}]; stockQty=1;
    }else{
        /* synthetic long: long call, short put same strike */
        legs=[{K:K,sig:sig,T:T,isCall:true,qty:1},{K:K,sig:sig,T:T,isCall:false,qty:-1}]; stockQty=0;
    }

    drawPayoffCanvas(ptCvs,ptCtx,legs,stockQty,S0);
    drawGreekCanvas(ptGCvs,ptGCtx,legs,stockQty,S0);

    var delta=stockQty+legs.reduce(function(s,l){return s+l.qty*bsDelta(S0,l.K,R,sig,T,l.isCall);},0);
    var gamma=legs.reduce(function(s,l){return s+l.qty*bsGamma(S0,l.K,R,sig,T);},0);
    var vega =legs.reduce(function(s,l){return s+l.qty*bsVega(S0,l.K,R,sig,T);},0);
    var theta=legs.reduce(function(s,l){return s+l.qty*bsTheta(S0,l.K,R,sig,T,l.isCall);},0);
    var prem =legs.reduce(function(s,l){return s+l.qty*bsPrice(S0,l.K,R,sig,T,l.isCall);},0);
    document.getElementById('portGreekBadges').innerHTML=greekBadges(delta,gamma,vega,theta);
    document.getElementById('portStats').innerHTML=
        '<div class="stat-box"><div class="stat-label">Net option cost</div><div class="stat-val '+(prem<0?'green':'gold')+'">'+(prem>=0?'\u2212':'+')+(Math.abs(prem)).toFixed(2)+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">Strike K</div><div class="stat-val">\u00A3'+K+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">&Delta; total</div><div class="stat-val '+(delta>0?'green':'red')+'">'+(delta>=0?'+':'')+delta.toFixed(3)+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">&Gamma;</div><div class="stat-val '+(gamma>0?'green':'red')+'">'+(gamma>=0?'+':'')+gamma.toFixed(4)+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">&nu;</div><div class="stat-val '+(vega>0?'green':'red')+'">'+(vega>=0?'+':'')+vega.toFixed(3)+'</div></div>'+
        '<div class="stat-box"><div class="stat-label">&Theta;/day</div><div class="stat-val '+(theta>0?'green':'red')+'">'+(theta>=0?'+':'')+theta.toFixed(3)+'</div></div>';
}

['btnCovCall','btnProtPut','btnCollar','btnSynLong'].forEach(function(id){
    document.getElementById(id).addEventListener('click',function(){
        ptType=id==='btnCovCall'?'cc':id==='btnProtPut'?'pp':id==='btnCollar'?'col':'syn';
        ['btnCovCall','btnProtPut','btnCollar','btnSynLong'].forEach(function(b){document.getElementById(b).classList.toggle('active',b===id);});
        drawPort();
    });
});
['ptS','ptK','ptSig','ptT'].forEach(function(id){document.getElementById(id).addEventListener('input',drawPort);});

/* ═══════════════════════════════════════════════════
   SECTION 5: Greek Classification Canvas
═══════════════════════════════════════════════════ */
var gcCvs=document.getElementById('greekClassCanvas'),gcCtx=gcCvs.getContext('2d');

function drawGreekClass(){
    var W=gcCvs.width, H=gcCvs.height;
    clearDark(gcCvs,gcCtx);
    var PAD={l:80,r:30,t:40,b:50};
    var plotW=W-PAD.l-PAD.r, plotH=H-PAD.t-PAD.b;

    /* Axes: X = net delta (-1 to +1), Y = net gamma (negative to positive) */
    /* Each strategy is a bubble with vega encoded in radius */
    var strategies=[
        {name:'Long Call',   delta:0.5,  gamma:0.9,  vega:0.7,  theta:-0.7, col:'rgba(16,185,129,0.85)'},
        {name:'Long Put',    delta:-0.5, gamma:0.9,  vega:0.7,  theta:-0.7, col:'rgba(248,113,113,0.85)'},
        {name:'Short Call',  delta:-0.5, gamma:-0.9, vega:-0.7, theta:0.7,  col:'rgba(248,113,113,0.55)'},
        {name:'Short Put',   delta:0.5,  gamma:-0.9, vega:-0.7, theta:0.7,  col:'rgba(16,185,129,0.55)'},
        {name:'Bull Spread', delta:0.35, gamma:0.4,  vega:0.35, theta:-0.35,col:'rgba(34,211,238,0.80)'},
        {name:'Bear Spread', delta:-0.35,gamma:0.4,  vega:0.35, theta:-0.35,col:'rgba(34,211,238,0.60)'},
        {name:'Straddle',    delta:0.0,  gamma:1.0,  vega:1.0,  theta:-1.0, col:'rgba(251,191,36,0.88)'},
        {name:'Strangle',    delta:0.0,  gamma:0.7,  vega:0.75, theta:-0.75,col:'rgba(251,191,36,0.65)'},
        {name:'Short Strad', delta:0.0,  gamma:-1.0, vega:-1.0, theta:1.0,  col:'rgba(248,113,113,0.70)'},
        {name:'Butterfly',   delta:0.0,  gamma:0.3,  vega:-0.1, theta:0.3,  col:'rgba(167,139,250,0.80)'},
        {name:'Iron Condor', delta:0.0,  gamma:-0.5, vega:-0.5, theta:0.5,  col:'rgba(167,139,250,0.60)'},
        {name:'Covered Call',delta:0.55, gamma:-0.5, vega:-0.5, theta:0.5,  col:'rgba(167,139,250,0.88)'},
        {name:'Risk Rev.',   delta:0.85, gamma:0.05, vega:0.05, theta:-0.05,col:'rgba(34,211,238,0.88)'},
        {name:'Collar',      delta:0.4,  gamma:-0.1, vega:-0.1, theta:0.1,  col:'rgba(167,139,250,0.70)'},
    ];

    /* Axes */
    function tx(d){return PAD.l+(d+1)/2*plotW;}
    function ty(g){return PAD.t+(1-g)/2*plotH;}

    /* Quadrant fills */
    var qfills=[
        {x:PAD.l,y:PAD.t,w:plotW/2,h:plotH/2,col:'rgba(251,191,36,0.025)',lbl:'Long Vol'},
        {x:PAD.l+plotW/2,y:PAD.t,w:plotW/2,h:plotH/2,col:'rgba(16,185,129,0.025)',lbl:'Long Directional + Vol'},
        {x:PAD.l,y:PAD.t+plotH/2,w:plotW/2,h:plotH/2,col:'rgba(248,113,113,0.025)',lbl:'Short Vol'},
        {x:PAD.l+plotW/2,y:PAD.t+plotH/2,w:plotW/2,h:plotH/2,col:'rgba(34,211,238,0.025)',lbl:'Directional'}
    ];
    qfills.forEach(function(q){
        gcCtx.fillStyle=q.col;gcCtx.fillRect(q.x,q.y,q.w,q.h);
    });

    /* Grid */
    gcCtx.strokeStyle='rgba(255,255,255,0.05)';gcCtx.lineWidth=1;
    [-1,-0.5,0,0.5,1].forEach(function(v){
        gcCtx.beginPath();gcCtx.moveTo(tx(v),PAD.t);gcCtx.lineTo(tx(v),PAD.t+plotH);gcCtx.stroke();
        gcCtx.fillStyle='#404058';gcCtx.font='9px Georgia';gcCtx.textAlign='center';gcCtx.textBaseline='top';
        gcCtx.fillText(v===0?'0':(v>0?'+':'')+v,tx(v),PAD.t+plotH+6);
    });
    [-1,-0.5,0,0.5,1].forEach(function(v){
        gcCtx.beginPath();gcCtx.moveTo(PAD.l,ty(v));gcCtx.lineTo(PAD.l+plotW,ty(v));gcCtx.stroke();
        gcCtx.fillStyle='#404058';gcCtx.font='9px Georgia';gcCtx.textAlign='right';gcCtx.textBaseline='middle';
        gcCtx.fillText(v===0?'0':(v>0?'+':'')+v,PAD.l-5,ty(v));
    });

    /* Axis lines */
    gcCtx.strokeStyle='rgba(255,255,255,0.15)';gcCtx.lineWidth=1;
    gcCtx.beginPath();gcCtx.moveTo(tx(0),PAD.t);gcCtx.lineTo(tx(0),PAD.t+plotH);gcCtx.stroke();
    gcCtx.beginPath();gcCtx.moveTo(PAD.l,ty(0));gcCtx.lineTo(PAD.l+plotW,ty(0));gcCtx.stroke();

    /* Bubbles */
    strategies.forEach(function(s){
        var x=tx(s.delta), y=ty(s.gamma);
        var r=6+Math.abs(s.vega)*10;
        /* glow */
        var grd=gcCtx.createRadialGradient(x,y,0,x,y,r*1.6);
        grd.addColorStop(0,s.col);grd.addColorStop(1,'transparent');
        gcCtx.fillStyle=grd;
        gcCtx.beginPath();gcCtx.arc(x,y,r*1.6,0,Math.PI*2);gcCtx.fill();
        /* dot */
        gcCtx.fillStyle=s.col;gcCtx.strokeStyle='rgba(255,255,255,0.15)';gcCtx.lineWidth=0.8;
        gcCtx.beginPath();gcCtx.arc(x,y,r,0,Math.PI*2);gcCtx.fill();gcCtx.stroke();
        /* label */
        gcCtx.fillStyle='rgba(255,255,255,0.65)';gcCtx.font='bold 8.5px Georgia';gcCtx.textAlign='center';gcCtx.textBaseline='bottom';
        gcCtx.fillText(s.name,x,y-r-2);
    });

    /* Axis labels */
    gcCtx.fillStyle='#505068';gcCtx.font='11px Georgia';gcCtx.textAlign='center';gcCtx.textBaseline='top';
    gcCtx.fillText('Net Delta (\u0394) \u2192 Direction',PAD.l+plotW/2,PAD.t+plotH+22);
    gcCtx.save();gcCtx.translate(14,PAD.t+plotH/2);gcCtx.rotate(-Math.PI/2);
    gcCtx.textAlign='center';gcCtx.textBaseline='middle';gcCtx.fillText('Net Gamma (\u0393) \u2192 Convexity',0,0);gcCtx.restore();

    /* Quadrant labels */
    gcCtx.font='9px Georgia';
    gcCtx.fillStyle='rgba(251,191,36,0.40)';gcCtx.textAlign='left';gcCtx.textBaseline='top';
    gcCtx.fillText('\u25B2 LONG VOL',PAD.l+4,PAD.t+4);
    gcCtx.fillStyle='rgba(248,113,113,0.40)';gcCtx.textAlign='left';gcCtx.textBaseline='bottom';
    gcCtx.fillText('\u25BC SHORT VOL',PAD.l+4,PAD.t+plotH-4);
    gcCtx.fillStyle='rgba(34,211,238,0.40)';gcCtx.textAlign='right';gcCtx.textBaseline='middle';
    gcCtx.fillText('DIRECTIONAL \u25BA',PAD.l+plotW-4,ty(0)-8);
    /* Vega note */
    gcCtx.fillStyle='rgba(255,255,255,0.18)';gcCtx.font='8px Georgia';gcCtx.textAlign='right';gcCtx.textBaseline='top';
    gcCtx.fillText('Bubble size \u221D |vega|',W-PAD.r,PAD.t+2);
}

/* ═══════════════════════════════════════════════════
   SECTION 6: Eight Questions Analyser
═══════════════════════════════════════════════════ */
var qaCvs=document.getElementById('qaCanvas'),qaCtx=qaCvs.getContext('2d');
var qaIdx=0;

var qaStrategies=[
    {name:'Long Call',
     build:function(K,sig,T){return {legs:[{K:K,sig:sig,T:T,isCall:true,qty:1}],stock:0};},
     maxGain:'Unlimited',maxLoss:'Limited to premium',convex:'Convex',
     delta:'+0.40 to +0.60',gamma:'++ (ATM peak)',vega:'++',kills:'Vol collapse + time decay'},
    {name:'Long Put',
     build:function(K,sig,T){return {legs:[{K:K,sig:sig,T:T,isCall:false,qty:1}],stock:0};},
     maxGain:'K \u2212 premium (if stock &rarr; 0)',maxLoss:'Limited to premium',convex:'Convex',
     delta:'\u22120.40 to \u22120.60',gamma:'++ (ATM peak)',vega:'++',kills:'Vol collapse + time decay'},
    {name:'Short Call',
     build:function(K,sig,T){return {legs:[{K:K,sig:sig,T:T,isCall:true,qty:-1}],stock:0};},
     maxGain:'Premium received',maxLoss:'Unlimited (above K)',convex:'Concave',
     delta:'\u22120.40 to \u22120.60',gamma:'\u2212\u2212 (ATM trough)',vega:'\u2212\u2212',kills:'Large upward spot move'},
    {name:'Short Put',
     build:function(K,sig,T){return {legs:[{K:K,sig:sig,T:T,isCall:false,qty:-1}],stock:0};},
     maxGain:'Premium received',maxLoss:'Up to K \u2212 premium',convex:'Concave',
     delta:'+0.40 to +0.60',gamma:'\u2212\u2212 (ATM trough)',vega:'\u2212\u2212',kills:'Large downward spot move'},
    {name:'Bull Call Spread',
     build:function(K,sig,T){return {legs:[{K:K-5,sig:sig,T:T,isCall:true,qty:1},{K:K+5,sig:sig,T:T,isCall:true,qty:-1}],stock:0};},
     maxGain:'K2\u2212K1 minus premium',maxLoss:'Net premium paid',convex:'Capped convex',
     delta:'+ (reduced)',gamma:'+ between strikes',vega:'+ (reduced)',kills:'Spot below K1'},
    {name:'Straddle',
     build:function(K,sig,T){return {legs:[{K:K,sig:sig,T:T,isCall:true,qty:1},{K:K,sig:sig,T:T,isCall:false,qty:1}],stock:0};},
     maxGain:'Unlimited both directions',maxLoss:'Total premium (both legs)',convex:'V-shaped',
     delta:'~0 at inception',gamma:'++++ (maximum)',vega:'++++',kills:'Realised vol < implied vol'},
    {name:'Butterfly',
     build:function(K,sig,T){return {legs:[{K:K-8,sig:sig,T:T,isCall:true,qty:1},{K:K,sig:sig,T:T,isCall:true,qty:-2},{K:K+8,sig:sig,T:T,isCall:true,qty:1}],stock:0};},
     maxGain:'Wing width minus premium',maxLoss:'Net premium paid',convex:'Tent (localised)',
     delta:'~0',gamma:'+ centre / \u2212 wings',vega:'Small / slightly \u2212',kills:'Large move away from centre'},
    {name:'Covered Call',
     build:function(K,sig,T){return {legs:[{K:K,sig:sig,T:T,isCall:true,qty:-1}],stock:1};},
     maxGain:'K \u2212 S + premium',maxLoss:'S \u2212 premium (stock falls to 0)',convex:'Capped linear',
     delta:'+0.4 to +0.6 (net)',gamma:'\u2212 (short call)',vega:'\u2212',kills:'Sharp rally above K'},
    {name:'Collar',
     build:function(K,sig,T){return {legs:[{K:Math.round(K*0.93),sig:sig,T:T,isCall:false,qty:1},{K:K,sig:sig,T:T,isCall:true,qty:-1}],stock:1};},
     maxGain:'K\u2212S0 + net prem (capped)',maxLoss:'S0\u2212Kput + net prem',convex:'Flat band',
     delta:'Positive between strikes',gamma:'Near zero between strikes',vega:'Near zero (net)',kills:'Nothing \u2014 that is the point'},
];

function drawQA(){
    var idx=qaIdx;
    var S0=100,K=100,sig=0.20,T=3/12;
    var strat=qaStrategies[idx];
    var built=strat.build(K,sig,T);
    drawPayoffCanvas(qaCvs,qaCtx,built.legs,built.stock,S0);

    var delta=built.stock+built.legs.reduce(function(s,l){return s+l.qty*bsDelta(S0,l.K,R,sig,T,l.isCall);},0);
    var gamma=built.legs.reduce(function(s,l){return s+l.qty*bsGamma(S0,l.K,R,sig,T);},0);
    var vega =built.legs.reduce(function(s,l){return s+l.qty*bsVega(S0,l.K,R,sig,T);},0);
    var theta=built.legs.reduce(function(s,l){return s+l.qty*bsTheta(S0,l.K,R,sig,T,l.isCall);},0);
    var prem =built.legs.reduce(function(s,l){return s+l.qty*bsPrice(S0,l.K,R,sig,T,l.isCall);},0);

    document.getElementById('qaGrid').innerHTML=
    '<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px">'+
    qaQ('Max gain',strat.maxGain,'green')+
    qaQ('Max loss',strat.maxLoss,'red')+
    qaQ('Breakeven','~\u00A3'+(K+Math.abs(prem)*(prem>0?1:-1)).toFixed(2),'')+
    qaQ('Payoff shape',strat.convex,'cyan')+
    qaQ('\u0394 Delta','\u2248'+(delta>=0?'+':'')+delta.toFixed(2),(delta>0?'green':delta<0?'red':'muted'))+
    qaQ('Long/short vol',vega>0.01?'Long vol \u2191':vega<-0.01?'Short vol \u2193':'Neutral',(vega>0.01?'gold':vega<-0.01?'red':'muted'))+
    qaQ('\u0393 Gamma',gamma>=0?'Positive \u25b2':'Negative \u25bc',(gamma>0?'green':'red'))+
    qaQ('What kills it',strat.kills,'pink')+
    '</div>';
}
function qaQ(q,a,col){
    return '<div style="background:rgba(255,255,255,0.018);border:1px solid rgba(255,255,255,0.06);border-radius:7px;padding:10px 12px">'+
           '<div style="font-size:0.7em;color:#606070;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px">'+q+'</div>'+
           '<div style="font-family:\'Courier New\',monospace;font-size:0.9em;color:'+(col==='green'?'#10b981':col==='red'?'#f87171':col==='cyan'?'#22d3ee':col==='gold'?'#fbbf24':col==='pink'?'#f472b6':col==='muted'?'#606070':'#e0e0e0')+'">'+(a)+'</div>'+
           '</div>';
}

for(var qi=0;qi<=8;qi++){
    (function(i){
        document.getElementById('qa'+i).addEventListener('click',function(){
            qaIdx=i;
            for(var j=0;j<=8;j++) document.getElementById('qa'+j).classList.toggle('active',j===i);
            drawQA();
        });
    })(qi);
}

/* ═══════════════════════════════════════════════════
   Initialise all
═══════════════════════════════════════════════════ */
drawSingle();
drawSpread();
drawVol();
drawPort();
drawGreekClass();
drawQA();
</script>
<footer style="text-align:center;padding:26px 20px 16px;color:#505068;font-size:0.72em;line-height:1.7;border-top:1px solid rgba(255,255,255,0.05);margin-top:30px">
    <div>&copy; 2025&ndash;2026 Manoj Bhaskar &middot; Coded by <a href="https://claude.ai" style="color:#606078;text-decoration:none" target="_blank" rel="noopener">Claude</a> &middot; <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" style="color:#606078;text-decoration:none" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a></div>
</footer>
</body>
</html>
