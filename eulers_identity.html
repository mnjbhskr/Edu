<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Euler's Identity — The Most Beautiful Equation</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0a0a1a;
            color: #e0e0e0;
            font-family: 'Segoe UI', Arial, sans-serif;
            padding: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 { font-size: 22px; margin-bottom: 2px; color: #f0f0f0; }
        .subtitle { font-size: 13px; color: #aaa; margin-bottom: 4px; }
        .analogy {
            max-width: 900px;
            text-align: center;
            font-size: 13px;
            color: #f0c040;
            margin: 4px 0 12px 0;
        }
        .main-row {
            display: flex;
            gap: 14px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
        }
        canvas {
            background: #0d0d24;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 270px;
            max-width: 290px;
        }
        .card {
            background: #16213e;
            border-radius: 10px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.3);
            padding: 12px 14px;
        }
        .card-title {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #7da2e0;
            margin-bottom: 6px;
        }
        .identity-box {
            text-align: center;
            padding: 12px;
            border-radius: 10px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(240,192,64,0.1);
            transition: border-color 0.5s, box-shadow 0.5s;
        }
        .identity-box.glow {
            border-color: rgba(240,192,64,0.6);
            box-shadow: 0 0 20px rgba(240,192,64,0.15);
        }
        .identity-eq {
            font-size: 32px;
            font-family: 'Georgia', 'Times New Roman', serif;
            letter-spacing: 2px;
        }
        .c-e { color: #e94560; }
        .c-i { color: #3b82f6; }
        .c-pi { color: #f0c040; }
        .c-one { color: #2ecc71; }
        .c-zero { color: #a78bfa; }
        .formula-box {
            font-family: 'Georgia', serif;
            font-size: 16px;
            text-align: center;
            padding: 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            margin-bottom: 6px;
            line-height: 1.6;
        }
        .values-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 2px 10px;
            font-size: 12px;
        }
        .values-grid .lbl { color: #888; }
        .values-grid .val { font-family: monospace; }
        .btn-row { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 4px; }
        button {
            background: #0f3460;
            color: #e0e0e0;
            border: 1px solid #1a5276;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            transition: background 0.15s;
        }
        button:hover { background: #1a5276; }
        button.active { background: #e94560; border-color: #e94560; }
        .slider-row {
            display: flex;
            align-items: center;
            gap: 5px;
            margin: 3px 0;
            font-size: 11px;
        }
        .slider-row label { min-width: 16px; color: #888; }
        .slider-row input[type=range] { flex: 1; height: 16px; }
        .slider-row .val { font-family: monospace; font-size: 11px; min-width: 40px; text-align: right; color: #aaa; }
        .check-row {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            margin: 3px 0;
        }
        .check-row input { accent-color: #e94560; }
        .taylor-terms {
            font-size: 10px;
            font-family: monospace;
            line-height: 1.5;
            max-height: 140px;
            overflow-y: auto;
            margin-top: 4px;
        }
        .taylor-terms::-webkit-scrollbar { width: 4px; }
        .taylor-terms::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
        .insight-box {
            background: rgba(240,192,64,0.08);
            border: 1px solid rgba(240,192,64,0.15);
            border-radius: 8px;
            padding: 10px;
            font-size: 11px;
            line-height: 1.5;
        }
        .five-constants {
            display: flex;
            justify-content: center;
            gap: 14px;
            margin-top: 6px;
            font-size: 11px;
        }
        .five-constants span {
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Euler's Identity</h1>
    <div class="subtitle">Five fundamental constants, one equation</div>
    <div class="analogy">
        The exponential function e<sup>i&#952;</sup> traces a circle in the complex plane.
        At &#952; = &#960;, it reaches exactly &#8722;1 — giving us e<sup>i&#960;</sup> + 1 = 0,
        linking the five most important numbers in mathematics.
    </div>

    <div class="main-row">
        <div>
            <canvas id="canvas" width="520" height="520"></canvas>
        </div>
        <div class="side-panel">
            <div class="card">
                <div class="card-title">The Identity</div>
                <div class="identity-box" id="identityBox">
                    <div class="identity-eq">
                        <span class="c-e">e</span><sup><span class="c-i">i</span><span class="c-pi">&pi;</span></sup>
                        + <span class="c-one">1</span>
                        = <span class="c-zero">0</span>
                    </div>
                    <div class="five-constants">
                        <span><span class="c-e" style="font-size:16px;">e</span><br>growth</span>
                        <span><span class="c-i" style="font-size:16px;">i</span><br>imaginary</span>
                        <span><span class="c-pi" style="font-size:16px;">&pi;</span><br>circle</span>
                        <span><span class="c-one" style="font-size:16px;">1</span><br>unity</span>
                        <span><span class="c-zero" style="font-size:16px;">0</span><br>nothing</span>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-title">Euler's Formula</div>
                <div class="formula-box" id="formulaBox"></div>
                <div class="values-grid" id="valuesGrid"></div>
            </div>
            <div class="card">
                <div class="card-title">&theta; Control</div>
                <div class="slider-row">
                    <label>&theta;</label>
                    <input type="range" id="thetaSlider" min="0" max="6.2832" step="0.01" value="0">
                    <span class="val" id="thetaVal">0</span>
                </div>
                <div class="btn-row" id="angleBtns"></div>
                <div class="btn-row">
                    <button id="btnPlay" onclick="togglePlay()">Pause</button>
                    <button onclick="setTheta(0)">Reset &theta;=0</button>
                </div>
                <div class="slider-row">
                    <label style="min-width:36px;">Speed</label>
                    <input type="range" id="speedSlider" min="0.002" max="0.06" step="0.002" value="0.015">
                </div>
            </div>
            <div class="card">
                <div class="card-title">Taylor Series</div>
                <div class="check-row">
                    <input type="checkbox" id="chkTaylor" checked><label for="chkTaylor">Show Taylor series spiral</label>
                </div>
                <div class="slider-row">
                    <label style="min-width:40px;">Terms</label>
                    <input type="range" id="taylorSlider" min="1" max="25" step="1" value="12">
                    <span class="val" id="taylorVal">12</span>
                </div>
                <div style="font-size:10px;color:#666;margin:4px 0;">e<sup>i&theta;</sup> = &Sigma; (i&theta;)<sup>n</sup>/n! — watch it spiral to convergence</div>
                <div class="taylor-terms" id="taylorTerms"></div>
            </div>
            <div class="card">
                <div class="card-title">Insight</div>
                <div id="insightBox" class="insight-box"></div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        const cx = W / 2, cy = H / 2;

        // ---- State ----
        let theta = 0;
        let playing = true;
        let speed = 0.015;
        let showTaylor = true;
        let taylorN = 12;
        let scale = 180; // pixels per unit

        // ---- Complex arithmetic ----
        function cmul(a, b) { return { re: a.re * b.re - a.im * b.im, im: a.re * b.im + a.im * b.re }; }

        // ---- Coordinate transforms ----
        function toSX(re) { return cx + re * scale; }
        function toSY(im) { return cy - im * scale; }

        // ---- Taylor series ----
        function computeTaylor(th, n) {
            const terms = [];
            let power = { re: 1, im: 0 }; // (iθ)^0
            let fact = 1;
            for (let k = 0; k < n; k++) {
                if (k > 0) { fact *= k; power = cmul(power, { re: 0, im: th }); }
                terms.push({ re: power.re / fact, im: power.im / fact });
            }
            return terms;
        }

        function partialSums(terms) {
            const sums = [{ re: 0, im: 0 }];
            let s = { re: 0, im: 0 };
            for (const t of terms) {
                s = { re: s.re + t.re, im: s.im + t.im };
                sums.push({ re: s.re, im: s.im });
            }
            return sums;
        }

        // ---- Dynamic scale ----
        function computeScale() {
            if (!showTaylor || taylorN < 2) { scale = 180; return; }
            const terms = computeTaylor(theta, taylorN);
            const sums = partialSums(terms);
            let maxR = 1;
            sums.forEach(s => { maxR = Math.max(maxR, Math.sqrt(s.re * s.re + s.im * s.im)); });
            scale = Math.min(180, Math.max(40, 200 / (maxR + 0.3)));
        }

        // ---- Drawing ----
        const taylorColors = ['#e94560','#ff6b35','#f0c040','#2ecc71','#3b82f6','#a78bfa','#ff69b4','#00d4aa','#e94560','#ff6b35','#f0c040','#2ecc71','#3b82f6','#a78bfa','#ff69b4','#00d4aa','#e94560','#ff6b35','#f0c040','#2ecc71','#3b82f6','#a78bfa','#ff69b4','#00d4aa','#e94560'];

        function draw() {
            ctx.clearRect(0, 0, W, H);
            computeScale();

            const cosT = Math.cos(theta), sinT = Math.sin(theta);
            const px = toSX(cosT), py = toSY(sinT);

            // Grid
            ctx.strokeStyle = 'rgba(255,255,255,0.04)';
            ctx.lineWidth = 1;
            for (let v = -5; v <= 5; v++) {
                const sx = toSX(v);
                if (sx > 0 && sx < W) { ctx.beginPath(); ctx.moveTo(sx, 0); ctx.lineTo(sx, H); ctx.stroke(); }
                const sy = toSY(v);
                if (sy > 0 && sy < H) { ctx.beginPath(); ctx.moveTo(0, sy); ctx.lineTo(W, sy); ctx.stroke(); }
            }

            // Axes
            ctx.strokeStyle = 'rgba(255,255,255,0.18)';
            ctx.lineWidth = 1.5;
            ctx.beginPath(); ctx.moveTo(0, cy); ctx.lineTo(W, cy); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(cx, 0); ctx.lineTo(cx, H); ctx.stroke();

            // Axis labels
            ctx.fillStyle = 'rgba(255,255,255,0.25)';
            ctx.font = 'italic 13px Georgia, serif';
            ctx.textAlign = 'left';
            ctx.fillText('Re', W - 24, cy - 8);
            ctx.textAlign = 'center';
            ctx.fillText('Im', cx + 16, 16);

            // Unit circle
            ctx.beginPath();
            ctx.arc(cx, cy, scale, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(255,255,255,0.12)';
            ctx.lineWidth = 1.5;
            ctx.setLineDash([6, 4]);
            ctx.stroke();
            ctx.setLineDash([]);

            // Special points on unit circle
            const specials = [
                { re: 1, im: 0, label: '1', color: '#2ecc71' },
                { re: 0, im: 1, label: 'i', color: '#3b82f6' },
                { re: -1, im: 0, label: '\u22121', color: '#e94560' },
                { re: 0, im: -1, label: '\u2212i', color: '#a78bfa' },
            ];
            specials.forEach(sp => {
                const sx = toSX(sp.re), sy = toSY(sp.im);
                ctx.beginPath(); ctx.arc(sx, sy, 3, 0, Math.PI * 2);
                ctx.fillStyle = sp.color + '80'; ctx.fill();
                ctx.font = 'bold 12px Georgia, serif';
                ctx.fillStyle = sp.color;
                ctx.textAlign = sp.re >= 0 ? 'left' : 'right';
                const ox = sp.re >= 0 ? 8 : -8;
                const oy = sp.im >= 0 ? -8 : 14;
                ctx.fillText(sp.label, sx + ox, sy + oy);
            });

            // Axis tick labels
            ctx.font = '9px monospace';
            ctx.fillStyle = 'rgba(255,255,255,0.15)';
            ctx.textAlign = 'center';
            for (let v = -4; v <= 4; v++) {
                if (v === 0) continue;
                const sx = toSX(v);
                if (sx > 20 && sx < W - 20) ctx.fillText(v, sx, cy + 14);
                const sy = toSY(v);
                if (sy > 20 && sy < H - 20) { ctx.textAlign = 'right'; ctx.fillText(v + 'i', cx - 6, sy + 4); ctx.textAlign = 'center'; }
            }

            // --- Taylor series spiral ---
            if (showTaylor && taylorN > 0) {
                const terms = computeTaylor(theta, taylorN);
                const sums = partialSums(terms);

                // Draw spiral path (faint)
                ctx.beginPath();
                ctx.moveTo(toSX(sums[0].re), toSY(sums[0].im));
                for (let i = 1; i < sums.length; i++) {
                    ctx.lineTo(toSX(sums[i].re), toSY(sums[i].im));
                }
                ctx.strokeStyle = 'rgba(255,255,255,0.08)';
                ctx.lineWidth = 1;
                ctx.stroke();

                // Draw term vectors
                for (let i = 0; i < terms.length; i++) {
                    const from = sums[i], to = sums[i + 1];
                    const sx1 = toSX(from.re), sy1 = toSY(from.im);
                    const sx2 = toSX(to.re), sy2 = toSY(to.im);
                    const len = Math.sqrt((sx2 - sx1) ** 2 + (sy2 - sy1) ** 2);
                    if (len < 0.5) continue;

                    const col = taylorColors[i % taylorColors.length];
                    const alpha = Math.max(0.2, 1 - i * 0.04);
                    ctx.save();
                    ctx.globalAlpha = alpha;
                    ctx.strokeStyle = col;
                    ctx.lineWidth = Math.max(1, 2.5 - i * 0.1);
                    ctx.beginPath();
                    ctx.moveTo(sx1, sy1);
                    ctx.lineTo(sx2, sy2);
                    ctx.stroke();

                    // Arrowhead
                    if (len > 6) {
                        const ux = (sx2 - sx1) / len, uy = (sy2 - sy1) / len;
                        const as = Math.min(6, len * 0.3);
                        ctx.beginPath();
                        ctx.moveTo(sx2, sy2);
                        ctx.lineTo(sx2 - ux * as - uy * as * 0.5, sy2 - uy * as + ux * as * 0.5);
                        ctx.lineTo(sx2 - ux * as + uy * as * 0.5, sy2 - uy * as - ux * as * 0.5);
                        ctx.closePath();
                        ctx.fillStyle = col;
                        ctx.fill();
                    }

                    // Partial sum dot
                    ctx.beginPath(); ctx.arc(sx2, sy2, 2.5, 0, Math.PI * 2);
                    ctx.fillStyle = col; ctx.fill();

                    // Label first few terms
                    if (i < 6 && len > 12) {
                        const mx = (sx1 + sx2) / 2, my = (sy1 + sy2) / 2;
                        const nx = -(sy2 - sy1) / len, ny = (sx2 - sx1) / len;
                        ctx.font = '8px monospace';
                        ctx.fillStyle = col;
                        ctx.textAlign = 'center';
                        ctx.fillText('n=' + i, mx + nx * 10, my + ny * 10);
                    }
                    ctx.restore();
                }

                // Final partial sum — big dot
                const final = sums[sums.length - 1];
                const fsx = toSX(final.re), fsy = toSY(final.im);
                ctx.beginPath(); ctx.arc(fsx, fsy, 4, 0, Math.PI * 2);
                ctx.fillStyle = '#fff'; ctx.fill();
                ctx.font = '9px monospace';
                ctx.fillStyle = '#aaa';
                ctx.textAlign = 'left';
                ctx.fillText('S' + taylorN, fsx + 8, fsy + 4);
            }

            // --- Projection lines ---
            // Vertical: from point to Re axis (shows cos θ)
            ctx.setLineDash([4, 4]);
            ctx.lineWidth = 1;
            ctx.strokeStyle = '#2ecc7180';
            ctx.beginPath(); ctx.moveTo(px, py); ctx.lineTo(px, cy); ctx.stroke();
            // Highlight cos θ on Re axis
            ctx.strokeStyle = '#2ecc71';
            ctx.lineWidth = 3;
            ctx.setLineDash([]);
            ctx.beginPath(); ctx.moveTo(cx, cy); ctx.lineTo(px, cy); ctx.stroke();
            ctx.font = 'bold 10px monospace';
            ctx.fillStyle = '#2ecc71';
            ctx.textAlign = 'center';
            ctx.fillText('cos\u03B8=' + cosT.toFixed(2), (cx + px) / 2, cy + 24);

            // Horizontal: from point to Im axis (shows sin θ)
            ctx.setLineDash([4, 4]);
            ctx.lineWidth = 1;
            ctx.strokeStyle = '#3b82f680';
            ctx.beginPath(); ctx.moveTo(px, py); ctx.lineTo(cx, py); ctx.stroke();
            // Highlight sin θ on Im axis
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 3;
            ctx.setLineDash([]);
            ctx.beginPath(); ctx.moveTo(cx, cy); ctx.lineTo(cx, py); ctx.stroke();
            ctx.font = 'bold 10px monospace';
            ctx.fillStyle = '#3b82f6';
            ctx.textAlign = 'left';
            ctx.fillText('sin\u03B8=' + sinT.toFixed(2), cx + 8, (cy + py) / 2);

            // --- Main vector ---
            ctx.save();
            ctx.strokeStyle = '#f0c040';
            ctx.lineWidth = 2.5;
            ctx.shadowBlur = 8;
            ctx.shadowColor = '#f0c040';
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.lineTo(px, py);
            ctx.stroke();
            ctx.shadowBlur = 0;
            // Arrowhead
            const vlen = Math.sqrt((px - cx) ** 2 + (py - cy) ** 2);
            if (vlen > 10) {
                const ux = (px - cx) / vlen, uy = (py - cy) / vlen;
                ctx.beginPath();
                ctx.moveTo(px, py);
                ctx.lineTo(px - ux * 10 - uy * 5, py - uy * 10 + ux * 5);
                ctx.lineTo(px - ux * 10 + uy * 5, py - uy * 10 - ux * 5);
                ctx.closePath();
                ctx.fillStyle = '#f0c040';
                ctx.fill();
            }
            ctx.restore();

            // Angle arc
            if (theta > 0.05) {
                const arcR = Math.min(35, scale * 0.2);
                ctx.beginPath();
                ctx.arc(cx, cy, arcR, 0, -theta, true);
                ctx.strokeStyle = '#f0c04080';
                ctx.lineWidth = 2;
                ctx.stroke();
                // θ label
                const labelAngle = -theta / 2;
                ctx.font = 'bold 12px Georgia, serif';
                ctx.fillStyle = '#f0c040';
                ctx.textAlign = 'center';
                ctx.fillText('\u03B8', cx + Math.cos(labelAngle) * (arcR + 14), cy + Math.sin(labelAngle) * (arcR + 14));
            }

            // Point e^(iθ)
            ctx.beginPath(); ctx.arc(px, py, 7, 0, Math.PI * 2);
            ctx.fillStyle = '#f0c040'; ctx.fill();
            ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.stroke();

            // Point label
            ctx.font = 'bold 11px Georgia, serif';
            ctx.fillStyle = '#f0c040';
            ctx.textAlign = theta > Math.PI ? 'right' : 'left';
            const lblOx = theta > Math.PI ? -12 : 12;
            const lblOy = sinT >= 0 ? -14 : 18;
            ctx.fillText('e', px + lblOx, py + lblOy);
            ctx.font = 'bold 9px Georgia, serif';
            ctx.fillText('i\u03B8', px + lblOx + (theta > Math.PI ? -10 : 8), py + lblOy - 4);

            // Title equation on canvas
            ctx.save();
            ctx.font = '15px Georgia, serif';
            ctx.textAlign = 'center';
            ctx.fillStyle = 'rgba(255,255,255,0.5)';
            const atPi = Math.abs(theta - Math.PI) < 0.08;
            if (atPi) {
                ctx.fillStyle = '#f0c040';
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#f0c040';
                ctx.fillText('e\u2071\u03C0 + 1 = 0', W / 2, 26);
                ctx.shadowBlur = 0;
            } else {
                ctx.fillText('e\u2071\u03B8 = cos\u03B8 + i\u00B7sin\u03B8', W / 2, 26);
            }
            ctx.restore();
        }

        // ---- Format helpers ----
        function fmtN(v) { return Math.abs(v) < 0.005 ? '0' : v.toFixed(3); }
        function fmtAngle(th) {
            const fracs = [
                [0, '0'], [Math.PI / 6, '\u03C0/6'], [Math.PI / 4, '\u03C0/4'],
                [Math.PI / 3, '\u03C0/3'], [Math.PI / 2, '\u03C0/2'],
                [2 * Math.PI / 3, '2\u03C0/3'], [Math.PI, '\u03C0'],
                [3 * Math.PI / 2, '3\u03C0/2'], [2 * Math.PI, '2\u03C0'],
            ];
            for (const [v, s] of fracs) {
                if (Math.abs(th - v) < 0.02) return s;
            }
            return th.toFixed(2);
        }

        // ---- UI updates ----
        function updateUI() {
            const cosT = Math.cos(theta), sinT = Math.sin(theta);
            const atPi = Math.abs(theta - Math.PI) < 0.08;

            document.getElementById('thetaVal').textContent = fmtAngle(theta);
            document.getElementById('thetaSlider').value = theta;
            document.getElementById('taylorVal').textContent = taylorN;
            document.getElementById('identityBox').className = 'identity-box' + (atPi ? ' glow' : '');

            // Formula
            document.getElementById('formulaBox').innerHTML =
                '<span class="c-e">e</span><sup><span class="c-i">i</span>(' + fmtAngle(theta) + ')</sup>'
                + ' = <span class="c-one">' + fmtN(cosT) + '</span>'
                + ' + <span class="c-i">i</span>\u00B7<span class="c-i">' + fmtN(sinT) + '</span>';

            // Values
            document.getElementById('valuesGrid').innerHTML =
                '<span class="lbl">\u03B8</span><span class="val">' + fmtAngle(theta) + ' (' + theta.toFixed(3) + ' rad)</span>'
                + '<span class="lbl">cos \u03B8</span><span class="val" style="color:#2ecc71;">' + fmtN(cosT) + '</span>'
                + '<span class="lbl">sin \u03B8</span><span class="val" style="color:#3b82f6;">' + fmtN(sinT) + '</span>'
                + '<span class="lbl">e<sup>i\u03B8</sup></span><span class="val" style="color:#f0c040;">' + fmtN(cosT) + ' + ' + fmtN(sinT) + 'i</span>'
                + '<span class="lbl">|e<sup>i\u03B8</sup>|</span><span class="val">1.000  (always!)</span>';

            // Taylor terms
            if (showTaylor) {
                const terms = computeTaylor(theta, taylorN);
                const sums = partialSums(terms);
                let html = '';
                terms.forEach((t, i) => {
                    const col = taylorColors[i % taylorColors.length];
                    html += '<div style="color:' + col + ';">n=' + i + ': ';
                    html += fmtN(t.re);
                    if (t.im >= 0) html += ' + ' + fmtN(t.im) + 'i';
                    else html += ' \u2212 ' + fmtN(-t.im) + 'i';
                    html += '</div>';
                });
                const final = sums[sums.length - 1];
                html += '<div style="border-top:1px solid rgba(255,255,255,0.1);margin-top:4px;padding-top:4px;color:#fff;">'
                    + 'Sum: ' + fmtN(final.re) + ' + ' + fmtN(final.im) + 'i</div>';
                html += '<div style="color:#f0c040;">True: ' + fmtN(cosT) + ' + ' + fmtN(sinT) + 'i</div>';
                const err = Math.sqrt((final.re - cosT) ** 2 + (final.im - sinT) ** 2);
                html += '<div style="color:#888;">Error: ' + err.toExponential(2) + '</div>';
                document.getElementById('taylorTerms').innerHTML = html;
            }

            // Insight
            updateInsight();
        }

        function updateInsight() {
            const box = document.getElementById('insightBox');
            const atPi = Math.abs(theta - Math.PI) < 0.08;
            const at0 = theta < 0.08;
            const atHalf = Math.abs(theta - Math.PI / 2) < 0.08;
            const at2Pi = Math.abs(theta - 2 * Math.PI) < 0.08;

            if (atPi) {
                box.innerHTML = '<b style="color:#f0c040;">e<sup>i\u03C0</sup> + 1 = 0 — Euler\'s Identity!</b><br><br>'
                    + 'At \u03B8 = \u03C0, the vector has rotated exactly halfway around the circle, landing at \u22121 on the real axis. '
                    + 'This single equation unites: <b class="c-e">e</b> (continuous growth), <b class="c-i">i</b> (the imaginary unit), '
                    + '<b class="c-pi">\u03C0</b> (the circle constant), <b class="c-one">1</b> (multiplicative identity), '
                    + 'and <b class="c-zero">0</b> (additive identity).'
                    + '<br><br>The deep insight: <b>exponential growth in the imaginary direction IS rotation</b>.';
            } else if (at0) {
                box.innerHTML = '<b>\u03B8 = 0:</b> e<sup>i\u00B70</sup> = 1. The journey begins at 1 on the real axis. '
                    + 'The exponential function starts at its identity value, just as the cosine starts at its maximum.';
            } else if (atHalf) {
                box.innerHTML = '<b>\u03B8 = \u03C0/2:</b> e<sup>i\u03C0/2</sup> = i. A quarter turn brings us to the imaginary axis. '
                    + 'cos(\u03C0/2) = 0, sin(\u03C0/2) = 1. The real part vanishes and the imaginary part is pure.';
            } else if (at2Pi) {
                box.innerHTML = '<b>\u03B8 = 2\u03C0:</b> e<sup>i\u00B72\u03C0</sup> = 1. A full rotation returns to the start. '
                    + 'This is why e<sup>i\u03B8</sup> is <b>periodic</b> with period 2\u03C0 — the exponential function wraps around the circle endlessly.';
            } else if (showTaylor) {
                box.innerHTML = '<b>Taylor Series Spiral:</b> e<sup>i\u03B8</sup> = 1 + (i\u03B8) + (i\u03B8)\u00B2/2! + (i\u03B8)\u00B3/3! + ...'
                    + '<br><br>Each coloured arrow is one term of the series. Added tip-to-tail, they spiral inward toward the true value on the unit circle. '
                    + 'The terms alternate between real and imaginary (because powers of i cycle: 1, i, \u22121, \u2212i, 1, ...) and decrease in magnitude (because of the factorial). '
                    + '<br><br>Drag \u03B8 to see how the spiral shape changes. Near \u03B8 = 0 it converges fast; at \u03B8 = \u03C0 it spirals dramatically.';
            } else {
                box.innerHTML = '<b>Euler\'s Formula:</b> e<sup>i\u03B8</sup> = cos\u03B8 + i\u00B7sin\u03B8'
                    + '<br><br>The <span style="color:#2ecc71;">green</span> segment on the Re axis is cos\u03B8. '
                    + 'The <span style="color:#3b82f6;">blue</span> segment on the Im axis is sin\u03B8. '
                    + 'Together they give the position of e<sup>i\u03B8</sup> on the unit circle.'
                    + '<br><br>The magnitude is always 1: |e<sup>i\u03B8</sup>| = \u221A(cos\u00B2\u03B8 + sin\u00B2\u03B8) = 1. '
                    + 'Multiplication by e<sup>i\u03B8</sup> is pure <b>rotation</b>.';
            }
        }

        // ---- Angle presets ----
        const anglePresets = [
            { label: '0', val: 0 },
            { label: '\u03C0/6', val: Math.PI / 6 },
            { label: '\u03C0/4', val: Math.PI / 4 },
            { label: '\u03C0/3', val: Math.PI / 3 },
            { label: '\u03C0/2', val: Math.PI / 2 },
            { label: '\u03C0', val: Math.PI },
            { label: '3\u03C0/2', val: 3 * Math.PI / 2 },
            { label: '2\u03C0', val: 2 * Math.PI },
        ];
        const abDiv = document.getElementById('angleBtns');
        anglePresets.forEach(p => {
            const btn = document.createElement('button');
            btn.textContent = p.label;
            btn.onclick = () => { setTheta(p.val); };
            abDiv.appendChild(btn);
        });

        function setTheta(val) {
            theta = val;
            playing = false;
            document.getElementById('btnPlay').textContent = 'Play';
        }

        function togglePlay() {
            playing = !playing;
            document.getElementById('btnPlay').textContent = playing ? 'Pause' : 'Play';
        }

        // ---- Listeners ----
        document.getElementById('thetaSlider').addEventListener('input', function () {
            theta = parseFloat(this.value);
            playing = false;
            document.getElementById('btnPlay').textContent = 'Play';
        });
        document.getElementById('taylorSlider').addEventListener('input', function () {
            taylorN = parseInt(this.value);
            document.getElementById('taylorVal').textContent = taylorN;
        });
        document.getElementById('speedSlider').addEventListener('input', function () {
            speed = parseFloat(this.value);
        });
        document.getElementById('chkTaylor').addEventListener('change', function () {
            showTaylor = this.checked;
        });

        // ---- Animation ----
        function animate() {
            if (playing) {
                theta += speed;
                if (theta > 2 * Math.PI) theta -= 2 * Math.PI;
            }
            draw();
            updateUI();
            requestAnimationFrame(animate);
        }
        animate();
    </script>
<footer style="text-align:center;padding:28px 20px 18px;color:#505068;font-size:0.72em;line-height:1.7;border-top:1px solid rgba(255,255,255,0.04);margin-top:30px"><div>&copy; 2025&ndash;2026 Manoj Bhaskar &middot; Built in collaboration with <a href="https://claude.ai/claude-code" style="color:#606078;text-decoration:none" target="_blank" rel="noopener">Claude Code</a> &middot; <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" style="color:#606078;text-decoration:none" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a></div></footer>
</body>
</html>
