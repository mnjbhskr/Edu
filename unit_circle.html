<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Unit Circle</title>
    <meta name="description" content="The unit circle connects angles to sine and cosine. Drag the point around the circle and watch the wave form in real time.">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:#0a0a1a;color:#e0e0e0;font-family:Georgia,'Times New Roman',serif;line-height:1.6}
        .container{max-width:960px;margin:0 auto;padding:24px 28px 48px}
        .back{color:#606078;text-decoration:none;font-size:0.85em}
        .back:hover{color:#34d399}
        h1{font-size:1.8em;font-weight:400;color:#fff;margin:16px 0 4px}
        .subtitle{color:#808098;font-style:italic;margin-bottom:28px}
        h2{font-size:1.15em;font-weight:400;color:#fff;margin:28px 0 12px}
        canvas{display:block;border-radius:10px;border:1px solid rgba(255,255,255,0.06);cursor:crosshair}
        .panel{background:rgba(255,255,255,0.025);border:1px solid rgba(255,255,255,0.06);border-radius:10px;padding:18px 22px;margin-bottom:20px}
        .panel h3{font-weight:400;font-size:0.8em;color:#808098;text-transform:uppercase;letter-spacing:1px;margin-bottom:10px}
        .btn-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px}
        .btn{background:rgba(255,255,255,0.035);border:1px solid rgba(255,255,255,0.07);color:#b0b0c4;padding:5px 13px;border-radius:6px;cursor:pointer;font-family:Georgia,serif;font-size:0.92em;transition:all 0.2s}
        .btn:hover{background:rgba(255,255,255,0.07);color:#e0e0ef}
        .btn.active{background:rgba(52,211,153,0.13);border-color:rgba(52,211,153,0.4);color:#34d399}
        .math-line{font-family:'Courier New',monospace;font-size:0.92em;color:#c0c0d8;margin:4px 0;line-height:1.8}
        .math-line .emerald{color:#34d399}.math-line .red{color:#f87171}.math-line .blue{color:#60a5fa}.math-line .gold{color:#fbbf24}
        .math-line .muted{color:#808098}
        .explain{background:rgba(255,255,255,0.025);border:1px solid rgba(255,255,255,0.06);border-radius:10px;padding:20px 24px;margin-top:20px}
        .explain-name{color:#34d399;font-size:1.1em;margin-bottom:6px}
        .explain-text{color:#a0a0b8;font-size:0.9em;line-height:1.75}
        .slider-row{display:flex;align-items:center;gap:14px;margin:10px 0}
        .slider-row input[type=range]{flex:1;max-width:300px;accent-color:#34d399}
        .slider-label{color:#34d399;font-family:'Courier New',monospace;font-size:1.05em;min-width:50px}
        .flex-row{display:flex;gap:20px;flex-wrap:wrap}
        .flex-row>.flex-half{flex:1 1 300px;min-width:280px}
        .values-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px 16px;margin:10px 0}
        .val-item{font-family:'Courier New',monospace;font-size:0.88em;padding:4px 0}
        .val-label{color:#808098;font-size:0.8em}
        .quadrant-info{font-family:'Courier New',monospace;font-size:0.88em;color:#c0c0d8;margin:8px 0;line-height:1.8}
        .sign-pos{color:#34d399}.sign-neg{color:#f87171}
        .special-btn{background:rgba(255,255,255,0.025);border:1px solid rgba(255,255,255,0.05);color:#808098;padding:4px 9px;border-radius:5px;cursor:pointer;font-family:'Courier New',monospace;font-size:0.78em;transition:all 0.2s}
        .special-btn:hover{background:rgba(52,211,153,0.1);border-color:rgba(52,211,153,0.3);color:#34d399}
        .special-btn.fam30{border-left:2px solid #a78bfa}
        .special-btn.fam45{border-left:2px solid #fbbf24}
        .special-btn.fam60{border-left:2px solid #f87171}
        .special-btn.fam0{border-left:2px solid #60a5fa}
        .converter-input{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.1);color:#e0e0e0;padding:6px 10px;border-radius:6px;font-family:'Courier New',monospace;font-size:0.95em;width:120px;outline:none}
        .converter-input:focus{border-color:rgba(52,211,153,0.4)}
        .triangle-card{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);border-radius:8px;padding:14px;text-align:center}
        .triangle-card h4{font-weight:400;font-size:0.85em;color:#808098;margin-bottom:8px}
        @media(max-width:600px){canvas{width:100%!important;height:auto!important}}
    </style>
</head>
<body>
<div class="container">
    <a class="back" href="index.html">&larr; Back to Index</a>
    <h1>The Unit Circle</h1>
    <p class="subtitle">Every angle, every value &mdash; the foundation of trigonometry</p>

    <!-- ═══ SECTION 1: Interactive Unit Circle ═══ -->
    <h2>Interactive Unit Circle</h2>
    <div class="flex-row">
        <div style="flex:0 0 auto">
            <canvas id="mainCircle" width="500" height="500"></canvas>
        </div>
        <div style="flex:1 1 260px;min-width:260px">
            <div class="panel">
                <h3>Angle</h3>
                <div id="angleDisplay" class="math-line" style="font-size:1.1em"></div>
            </div>
            <div class="panel">
                <h3>Trigonometric Values</h3>
                <div class="values-grid" id="trigValues"></div>
            </div>
            <div class="panel">
                <h3>Quadrant &amp; Signs</h3>
                <div id="quadrantDisplay" class="quadrant-info"></div>
            </div>
            <div class="panel">
                <h3>Coordinates</h3>
                <div id="coordDisplay" class="math-line"></div>
            </div>
        </div>
    </div>

    <!-- ═══ SECTION 2: Special Angles Reference ═══ -->
    <h2>Special Angles Reference</h2>
    <div class="panel">
        <h3>Click any angle to snap the point</h3>
        <div class="btn-row" style="margin-bottom:8px">
            <button class="btn" id="toggleLabelsBtn">Show All Labels</button>
        </div>
        <div style="margin-bottom:10px;font-size:0.78em;color:#606078">
            <span style="color:#a78bfa">&#9632;</span> 30/150/210/330 family &ensp;
            <span style="color:#fbbf24">&#9632;</span> 45/135/225/315 family &ensp;
            <span style="color:#f87171">&#9632;</span> 60/120/240/300 family &ensp;
            <span style="color:#60a5fa">&#9632;</span> Quadrantal angles
        </div>
        <div class="btn-row" id="specialBtns" style="gap:5px"></div>
    </div>
    <canvas id="specialCanvas" width="500" height="500"></canvas>

    <!-- ═══ SECTION 3: Radians vs Degrees ═══ -->
    <h2>Radians vs Degrees</h2>
    <canvas id="radianCanvas" width="700" height="250"></canvas>
    <div class="panel" style="margin-top:16px">
        <h3>Angle Slider</h3>
        <div class="slider-row">
            <span class="math-line muted">Angle:</span>
            <input type="range" id="radianSlider" min="0" max="6283" value="3142" step="1">
            <span class="slider-label" id="radianSliderLabel"></span>
        </div>
        <div id="radianMath" class="math-line" style="margin-top:6px"></div>
    </div>
    <div class="panel">
        <h3>Conversion Formulas</h3>
        <div class="math-line muted" style="margin-bottom:8px">degrees = radians &times; 180/&pi; &ensp;&ensp; radians = degrees &times; &pi;/180</div>
        <div style="display:flex;gap:20px;align-items:center;flex-wrap:wrap">
            <div>
                <span class="val-label">Degrees:</span>
                <input type="text" class="converter-input" id="degInput" value="180" placeholder="degrees">
            </div>
            <span class="math-line muted">&harr;</span>
            <div>
                <span class="val-label">Radians:</span>
                <input type="text" class="converter-input" id="radInput" value="3.14159" placeholder="radians">
            </div>
        </div>
    </div>

    <!-- ═══ SECTION 4: Trig Function Graphs ═══ -->
    <h2>Trigonometric Function Graphs</h2>
    <div class="panel">
        <h3>Show Functions</h3>
        <div class="btn-row" id="graphBtns"></div>
    </div>
    <canvas id="graphCanvas" width="700" height="300"></canvas>
    <div class="panel" style="margin-top:12px">
        <div id="graphInfo" class="math-line muted" style="font-size:0.85em"></div>
    </div>

    <!-- ═══ SECTION 5: Reference Triangles ═══ -->
    <h2>Reference Triangles</h2>
    <div class="flex-row" style="gap:12px">
        <div class="flex-half">
            <div class="triangle-card">
                <h4>30-60-90 Triangle</h4>
                <canvas id="tri3060" width="220" height="200" style="cursor:default"></canvas>
                <div class="math-line muted" style="font-size:0.8em;margin-top:6px">Sides: 1, &radic;3, 2</div>
            </div>
        </div>
        <div class="flex-half">
            <div class="triangle-card">
                <h4>45-45-90 Triangle</h4>
                <canvas id="tri4545" width="220" height="200" style="cursor:default"></canvas>
                <div class="math-line muted" style="font-size:0.8em;margin-top:6px">Sides: 1, 1, &radic;2</div>
            </div>
        </div>
    </div>
    <div class="panel" style="margin-top:16px">
        <h3>Animate Reference Triangle Through Quadrants</h3>
        <div class="btn-row">
            <button class="btn" id="animTriBtn30">Rotate 30-60-90</button>
            <button class="btn" id="animTriBtn45">Rotate 45-45-90</button>
        </div>
        <canvas id="triAnimCanvas" width="400" height="400" style="cursor:default;margin-top:10px"></canvas>
        <div id="triAnimInfo" class="math-line muted" style="margin-top:8px;font-size:0.85em"></div>
    </div>

    <!-- ═══ SECTION 6: Explanation Panel ═══ -->
    <div class="explain" style="margin-top:28px">
        <div class="explain-name">What have we learnt?</div>
        <div class="explain-text">
            The unit circle unifies all of trigonometry &mdash; every identity, every graph, every value flows from this single circle of radius 1. The x-coordinate is cosine, the y-coordinate is sine, and every other trig function derives from these two.
            <br><br>
            <strong style="color:#c0c0d8">The ASTC rule:</strong> All six trig functions are positive in Quadrant I. Only Sine (and cosecant) are positive in Quadrant II. Only Tangent (and cotangent) are positive in Quadrant III. Only Cosine (and secant) are positive in Quadrant IV. Remember: <span style="color:#34d399">All Students Take Calculus</span>.
            <br><br>
            <strong style="color:#c0c0d8">Connection to complex numbers:</strong> Euler's formula e<sup>i&theta;</sup> = cos &theta; + i sin &theta; tells us that the unit circle in the complex plane is traced out by the complex exponential. Every point on the unit circle is a complex number of magnitude 1. This bridges trigonometry and complex analysis in one of the most beautiful results in mathematics.
            <br><br>
            <strong style="color:#c0c0d8">Key insight:</strong> Master the unit circle and trigonometry becomes visual, intuitive, and memorable. The special angles (multiples of 30 and 45 degrees) give exact values; the graphs of sine, cosine, and tangent are simply the unit circle unwound along the horizontal axis; and the reference triangles show why the values repeat with predictable sign changes across quadrants.
        </div>
    </div>
</div>

<script>
/* ══════════════════════════════════════════════════════════════
   SECTION 1: Interactive Unit Circle
   ══════════════════════════════════════════════════════════════ */
const mainCvs = document.getElementById('mainCircle');
const mainCtx = mainCvs.getContext('2d');
const MW = mainCvs.width, MH = mainCvs.height;
const mCx = MW/2, mCy = MH/2, mR = 180;

let theta = Math.PI/4; // current angle
let dragging = false;

/* Special angles data */
const specialAngles = [
    {deg:0,   rad:'0',      cos:'1',     sin:'0',     cosV:1,            sinV:0,           fam:'fam0'},
    {deg:30,  rad:'\u03C0/6',  cos:'\u221A3/2', sin:'1/2',   cosV:Math.sqrt(3)/2, sinV:0.5,        fam:'fam30'},
    {deg:45,  rad:'\u03C0/4',  cos:'\u221A2/2', sin:'\u221A2/2', cosV:Math.SQRT1_2, sinV:Math.SQRT1_2, fam:'fam45'},
    {deg:60,  rad:'\u03C0/3',  cos:'1/2',   sin:'\u221A3/2', cosV:0.5,          sinV:Math.sqrt(3)/2, fam:'fam60'},
    {deg:90,  rad:'\u03C0/2',  cos:'0',     sin:'1',     cosV:0,            sinV:1,           fam:'fam0'},
    {deg:120, rad:'2\u03C0/3', cos:'-1/2',  sin:'\u221A3/2', cosV:-0.5,         sinV:Math.sqrt(3)/2, fam:'fam60'},
    {deg:135, rad:'3\u03C0/4', cos:'-\u221A2/2',sin:'\u221A2/2', cosV:-Math.SQRT1_2,sinV:Math.SQRT1_2, fam:'fam45'},
    {deg:150, rad:'5\u03C0/6', cos:'-\u221A3/2',sin:'1/2',   cosV:-Math.sqrt(3)/2,sinV:0.5,        fam:'fam30'},
    {deg:180, rad:'\u03C0',    cos:'-1',    sin:'0',     cosV:-1,           sinV:0,           fam:'fam0'},
    {deg:210, rad:'7\u03C0/6', cos:'-\u221A3/2',sin:'-1/2',  cosV:-Math.sqrt(3)/2,sinV:-0.5,       fam:'fam30'},
    {deg:225, rad:'5\u03C0/4', cos:'-\u221A2/2',sin:'-\u221A2/2',cosV:-Math.SQRT1_2,sinV:-Math.SQRT1_2,fam:'fam45'},
    {deg:240, rad:'4\u03C0/3', cos:'-1/2',  sin:'-\u221A3/2',cosV:-0.5,         sinV:-Math.sqrt(3)/2,fam:'fam60'},
    {deg:270, rad:'3\u03C0/2', cos:'0',     sin:'-1',    cosV:0,            sinV:-1,          fam:'fam0'},
    {deg:300, rad:'5\u03C0/3', cos:'1/2',   sin:'-\u221A3/2',cosV:0.5,          sinV:-Math.sqrt(3)/2,fam:'fam60'},
    {deg:315, rad:'7\u03C0/4', cos:'\u221A2/2', sin:'-\u221A2/2',cosV:Math.SQRT1_2, sinV:-Math.SQRT1_2,fam:'fam45'},
    {deg:330, rad:'11\u03C0/6',cos:'\u221A3/2', sin:'-1/2',  cosV:Math.sqrt(3)/2, sinV:-0.5,       fam:'fam30'}
];

function getQuadrant(ang) {
    let a = ((ang % (2*Math.PI)) + 2*Math.PI) % (2*Math.PI);
    if (a < Math.PI/2) return 1;
    if (a < Math.PI) return 2;
    if (a < 3*Math.PI/2) return 3;
    return 4;
}

function toDeg(rad) { return rad * 180 / Math.PI; }
function toRad(deg) { return deg * Math.PI / 180; }
function normAngle(a) { return ((a % (2*Math.PI)) + 2*Math.PI) % (2*Math.PI); }

function fmtAngleRad(rad) {
    let a = normAngle(rad);
    /* Try to match a special angle */
    for (let s of specialAngles) {
        let sr = toRad(s.deg);
        if (Math.abs(a - sr) < 0.005) return s.rad;
    }
    return a.toFixed(3);
}

function drawMainCircle() {
    const cx = mainCtx;
    cx.clearRect(0, 0, MW, MH);
    cx.fillStyle = '#0a0a1a';
    cx.fillRect(0, 0, MW, MH);

    /* Grid */
    cx.strokeStyle = 'rgba(255,255,255,0.03)';
    cx.lineWidth = 1;
    for (let i = -2; i <= 2; i++) {
        if (i === 0) continue;
        let x = mCx + i * mR;
        cx.beginPath(); cx.moveTo(x, 0); cx.lineTo(x, MH); cx.stroke();
        let y = mCy + i * mR;
        cx.beginPath(); cx.moveTo(0, y); cx.lineTo(MW, y); cx.stroke();
    }

    /* Axes */
    cx.strokeStyle = 'rgba(255,255,255,0.18)';
    cx.lineWidth = 1.5;
    cx.beginPath(); cx.moveTo(0, mCy); cx.lineTo(MW, mCy); cx.stroke();
    cx.beginPath(); cx.moveTo(mCx, 0); cx.lineTo(mCx, MH); cx.stroke();

    /* Axis labels */
    cx.font = '13px Georgia';
    cx.fillStyle = '#808098';
    cx.textAlign = 'left'; cx.textBaseline = 'bottom';
    cx.fillText('x', MW - 18, mCy - 6);
    cx.textAlign = 'left'; cx.textBaseline = 'top';
    cx.fillText('y', mCx + 8, 6);

    /* Tick marks */
    cx.font = '10px Georgia'; cx.fillStyle = '#505068';
    cx.textAlign = 'center'; cx.textBaseline = 'top';
    cx.fillText('1', mCx + mR, mCy + 6);
    cx.fillText('-1', mCx - mR, mCy + 6);
    cx.textAlign = 'right'; cx.textBaseline = 'middle';
    cx.fillText('1', mCx - 6, mCy - mR);
    cx.fillText('-1', mCx - 6, mCy + mR);

    /* Unit circle */
    cx.strokeStyle = 'rgba(255,255,255,0.15)';
    cx.lineWidth = 1.5;
    cx.beginPath(); cx.arc(mCx, mCy, mR, 0, Math.PI * 2); cx.stroke();

    let cosVal = Math.cos(theta);
    let sinVal = Math.sin(theta);
    let px = mCx + cosVal * mR;
    let py = mCy - sinVal * mR;

    /* Cos line (horizontal, blue) */
    cx.strokeStyle = '#60a5fa';
    cx.lineWidth = 2.5;
    cx.beginPath(); cx.moveTo(mCx, mCy); cx.lineTo(px, mCy); cx.stroke();
    /* Label cos */
    cx.font = '11px Courier New'; cx.fillStyle = '#60a5fa';
    cx.textAlign = 'center'; cx.textBaseline = cosVal >= 0 ? 'top' : 'top';
    cx.fillText('cos', mCx + cosVal * mR / 2, mCy + 8);

    /* Sin line (vertical, red) */
    cx.strokeStyle = '#f87171';
    cx.lineWidth = 2.5;
    cx.beginPath(); cx.moveTo(px, mCy); cx.lineTo(px, py); cx.stroke();
    /* Label sin */
    cx.font = '11px Courier New'; cx.fillStyle = '#f87171';
    cx.textAlign = 'left'; cx.textBaseline = 'middle';
    cx.fillText('sin', px + 6, mCy + (py - mCy) / 2);

    /* Radius (emerald) */
    cx.strokeStyle = '#34d399';
    cx.lineWidth = 2;
    cx.beginPath(); cx.moveTo(mCx, mCy); cx.lineTo(px, py); cx.stroke();

    /* Angle arc */
    let na = normAngle(theta);
    if (na > 0.01) {
        cx.strokeStyle = 'rgba(52,211,153,0.6)';
        cx.lineWidth = 2;
        cx.beginPath();
        cx.arc(mCx, mCy, 30, 0, -na, true);
        cx.stroke();
        /* Theta label */
        let labelAng = -na / 2;
        cx.font = '13px Georgia'; cx.fillStyle = '#34d399';
        cx.textAlign = 'center'; cx.textBaseline = 'middle';
        cx.fillText('\u03B8', mCx + 42 * Math.cos(labelAng), mCy + 42 * Math.sin(labelAng));
    }

    /* Tangent line (gold) at x=1 */
    let tanVal = Math.tan(theta);
    let absNa = normAngle(theta);
    let showTan = Math.abs(Math.cos(theta)) > 0.02;
    if (showTan) {
        let tanScreenY = mCy - tanVal * mR;
        /* Clamp for display */
        let tanClampY = Math.max(mCy - mR * 3, Math.min(mCy + mR * 3, tanScreenY));
        cx.strokeStyle = '#fbbf24';
        cx.lineWidth = 2;
        cx.beginPath(); cx.moveTo(mCx + mR, mCy); cx.lineTo(mCx + mR, tanClampY); cx.stroke();
        /* Dashed line from origin to tangent point */
        cx.setLineDash([4, 4]);
        cx.strokeStyle = 'rgba(251,191,36,0.3)';
        cx.lineWidth = 1;
        cx.beginPath(); cx.moveTo(mCx, mCy); cx.lineTo(mCx + mR, tanClampY); cx.stroke();
        cx.setLineDash([]);
        /* Label tan */
        cx.font = '11px Courier New'; cx.fillStyle = '#fbbf24';
        cx.textAlign = 'left'; cx.textBaseline = 'middle';
        let tLabelY = mCy + (tanClampY - mCy) / 2;
        cx.fillText('tan', mCx + mR + 6, tLabelY);
    }

    /* Point P */
    cx.fillStyle = '#34d399';
    cx.beginPath(); cx.arc(px, py, 7, 0, Math.PI * 2); cx.fill();
    cx.fillStyle = '#fff';
    cx.beginPath(); cx.arc(px, py, 3, 0, Math.PI * 2); cx.fill();

    /* Point label */
    cx.font = '13px Georgia'; cx.fillStyle = '#34d399';
    let lOx = cosVal >= 0 ? 12 : -12;
    let lOy = sinVal >= 0 ? -14 : 14;
    cx.textAlign = cosVal >= 0 ? 'left' : 'right';
    cx.textBaseline = sinVal >= 0 ? 'bottom' : 'top';
    cx.fillText('P', px + lOx, py + lOy);

    /* Update side panel */
    updateTrigValues();
}

function updateTrigValues() {
    let na = normAngle(theta);
    let deg = toDeg(na);
    let cosV = Math.cos(theta);
    let sinV = Math.sin(theta);
    let tanV = Math.abs(Math.cos(theta)) > 1e-10 ? Math.tan(theta) : undefined;
    let cscV = Math.abs(sinV) > 1e-10 ? 1 / sinV : undefined;
    let secV = Math.abs(cosV) > 1e-10 ? 1 / cosV : undefined;
    let cotV = tanV !== undefined && Math.abs(tanV) > 1e-10 ? 1 / tanV : (Math.abs(sinV) < 1e-10 ? undefined : 0);

    /* Angle display */
    document.getElementById('angleDisplay').innerHTML =
        '<span class="emerald">\u03B8 = ' + deg.toFixed(1) + '\u00B0 = ' + fmtAngleRad(theta) + ' rad</span>';

    /* Trig values */
    function fv(v) { return v === undefined ? '<span style="color:#f87171">undef</span>' : v.toFixed(4); }
    let tv = document.getElementById('trigValues');
    tv.innerHTML =
        '<div class="val-item"><span class="val-label">sin \u03B8</span><br><span class="red">' + fv(sinV) + '</span></div>' +
        '<div class="val-item"><span class="val-label">cos \u03B8</span><br><span class="blue">' + fv(cosV) + '</span></div>' +
        '<div class="val-item"><span class="val-label">tan \u03B8</span><br><span class="gold">' + fv(tanV) + '</span></div>' +
        '<div class="val-item"><span class="val-label">csc \u03B8</span><br>' + fv(cscV) + '</div>' +
        '<div class="val-item"><span class="val-label">sec \u03B8</span><br>' + fv(secV) + '</div>' +
        '<div class="val-item"><span class="val-label">cot \u03B8</span><br>' + fv(cotV) + '</div>';

    /* Quadrant */
    let q = getQuadrant(theta);
    let qNames = ['', 'I', 'II', 'III', 'IV'];
    let astc = {
        1: {name:'All', desc:'All functions positive', signs:{sin:'+',cos:'+',tan:'+',csc:'+',sec:'+',cot:'+'}},
        2: {name:'Students (Sin)', desc:'Only sin, csc positive', signs:{sin:'+',cos:'-',tan:'-',csc:'+',sec:'-',cot:'-'}},
        3: {name:'Take (Tan)', desc:'Only tan, cot positive', signs:{sin:'-',cos:'-',tan:'+',csc:'-',sec:'-',cot:'+'}},
        4: {name:'Calculus (Cos)', desc:'Only cos, sec positive', signs:{sin:'-',cos:'+',tan:'-',csc:'-',sec:'+',cot:'-'}}
    };
    let qi = astc[q];
    let sh = '<span class="emerald">Quadrant ' + qNames[q] + '</span> &mdash; ' + qi.name + '<br>' +
             '<span style="font-size:0.82em;color:#808098">' + qi.desc + '</span><br>';
    let funcs = ['sin','cos','tan','csc','sec','cot'];
    for (let f of funcs) {
        let s = qi.signs[f];
        sh += '<span class="' + (s==='+' ? 'sign-pos' : 'sign-neg') + '">' + f + ': ' + s + '</span> &ensp;';
    }
    document.getElementById('quadrantDisplay').innerHTML = sh;

    /* Coordinates */
    /* Find if near special angle */
    let coordStr = '';
    let matched = false;
    for (let sa of specialAngles) {
        if (Math.abs(deg - sa.deg) < 1.5) {
            coordStr = '<span class="emerald">P = (' + sa.cos + ', ' + sa.sin + ')</span>';
            matched = true;
            break;
        }
    }
    if (!matched) {
        coordStr = '<span class="emerald">P = (' + cosV.toFixed(4) + ', ' + sinV.toFixed(4) + ')</span>';
    }
    document.getElementById('coordDisplay').innerHTML = coordStr;

    /* Update synchronized graph */
    drawGraph();
}

/* Dragging on main circle */
function getMainXY(e) {
    let r = mainCvs.getBoundingClientRect();
    return { x: (e.clientX - r.left) * (MW / r.width), y: (e.clientY - r.top) * (MH / r.height) };
}

function handleDragStart(sx, sy) {
    let px = mCx + Math.cos(theta) * mR;
    let py = mCy - Math.sin(theta) * mR;
    let dx = sx - px, dy = sy - py;
    if (dx*dx + dy*dy < 20*20) {
        dragging = true;
    }
}

function handleDragMove(sx, sy) {
    if (!dragging) return;
    theta = Math.atan2(-(sy - mCy), sx - mCx);
    if (theta < 0) theta += 2 * Math.PI;
    drawMainCircle();
    drawSpecialCanvas();
}

mainCvs.addEventListener('mousedown', e => { let p = getMainXY(e); handleDragStart(p.x, p.y); });
mainCvs.addEventListener('mousemove', e => { let p = getMainXY(e); handleDragMove(p.x, p.y); });
mainCvs.addEventListener('mouseup', () => { dragging = false; });
mainCvs.addEventListener('mouseleave', () => { dragging = false; });

mainCvs.addEventListener('touchstart', e => {
    e.preventDefault();
    let t = e.touches[0];
    let r = mainCvs.getBoundingClientRect();
    let p = { x: (t.clientX - r.left) * (MW / r.width), y: (t.clientY - r.top) * (MH / r.height) };
    handleDragStart(p.x, p.y);
}, {passive: false});
mainCvs.addEventListener('touchmove', e => {
    e.preventDefault();
    let t = e.touches[0];
    let r = mainCvs.getBoundingClientRect();
    let p = { x: (t.clientX - r.left) * (MW / r.width), y: (t.clientY - r.top) * (MH / r.height) };
    handleDragMove(p.x, p.y);
}, {passive: false});
mainCvs.addEventListener('touchend', () => { dragging = false; });


/* ══════════════════════════════════════════════════════════════
   SECTION 2: Special Angles Reference Canvas
   ══════════════════════════════════════════════════════════════ */
const specCvs = document.getElementById('specialCanvas');
const specCtx = specCvs.getContext('2d');
const SW = specCvs.width, SH = specCvs.height;
const sCx = SW/2, sCy = SH/2, sR = 180;
let showAllLabels = false;

/* Build special angle buttons */
(function buildSpecialBtns() {
    let container = document.getElementById('specialBtns');
    let html = '';
    for (let sa of specialAngles) {
        html += '<button class="special-btn ' + sa.fam + '" data-deg="' + sa.deg + '">' + sa.deg + '\u00B0 = ' + sa.rad + '</button>';
    }
    container.innerHTML = html;
    container.querySelectorAll('.special-btn').forEach(b => {
        b.addEventListener('click', () => {
            let d = parseInt(b.dataset.deg);
            theta = toRad(d);
            drawMainCircle();
            drawSpecialCanvas();
        });
    });
})();

document.getElementById('toggleLabelsBtn').addEventListener('click', function() {
    showAllLabels = !showAllLabels;
    this.textContent = showAllLabels ? 'Clean View' : 'Show All Labels';
    this.classList.toggle('active', showAllLabels);
    drawSpecialCanvas();
});

function drawSpecialCanvas() {
    const cx = specCtx;
    cx.clearRect(0, 0, SW, SH);
    cx.fillStyle = '#0a0a1a';
    cx.fillRect(0, 0, SW, SH);

    /* Axes */
    cx.strokeStyle = 'rgba(255,255,255,0.18)';
    cx.lineWidth = 1.5;
    cx.beginPath(); cx.moveTo(0, sCy); cx.lineTo(SW, sCy); cx.stroke();
    cx.beginPath(); cx.moveTo(sCx, 0); cx.lineTo(sCx, SH); cx.stroke();

    /* Unit circle */
    cx.strokeStyle = 'rgba(255,255,255,0.12)';
    cx.lineWidth = 1;
    cx.beginPath(); cx.arc(sCx, sCy, sR, 0, Math.PI * 2); cx.stroke();

    /* Tick marks */
    cx.font = '10px Georgia'; cx.fillStyle = '#505068';
    cx.textAlign = 'center'; cx.textBaseline = 'top';
    cx.fillText('1', sCx + sR, sCy + 6);
    cx.fillText('-1', sCx - sR, sCy + 6);
    cx.textAlign = 'right'; cx.textBaseline = 'middle';
    cx.fillText('1', sCx - 6, sCy - sR);
    cx.fillText('-1', sCx - 6, sCy + sR);

    let na = normAngle(theta);
    let currentDeg = toDeg(na);

    /* Family colors */
    let famColors = {fam30: '#a78bfa', fam45: '#fbbf24', fam60: '#f87171', fam0: '#60a5fa'};

    /* Draw special angle points */
    for (let sa of specialAngles) {
        let aRad = toRad(sa.deg);
        let px = sCx + Math.cos(aRad) * sR;
        let py = sCy - Math.sin(aRad) * sR;
        let color = famColors[sa.fam];
        let isCurrent = Math.abs(currentDeg - sa.deg) < 2;

        /* Reference triangle for current angle */
        if (isCurrent && sa.deg % 90 !== 0) {
            let footX = sCx + Math.cos(aRad) * sR;
            cx.fillStyle = 'rgba(52,211,153,0.06)';
            cx.strokeStyle = 'rgba(52,211,153,0.25)';
            cx.lineWidth = 1;
            cx.beginPath();
            cx.moveTo(sCx, sCy);
            cx.lineTo(px, sCy);
            cx.lineTo(px, py);
            cx.closePath();
            cx.fill();
            cx.stroke();
        }

        /* Dot */
        cx.fillStyle = isCurrent ? '#34d399' : color;
        let dotR = isCurrent ? 6 : 4;
        cx.beginPath(); cx.arc(px, py, dotR, 0, Math.PI * 2); cx.fill();

        /* Labels */
        if (showAllLabels || isCurrent) {
            let labelR = sR + (isCurrent ? 50 : 30);
            let lx = sCx + Math.cos(aRad) * labelR;
            let ly = sCy - Math.sin(aRad) * labelR;

            cx.font = isCurrent ? '11px Courier New' : '9px Courier New';
            cx.fillStyle = isCurrent ? '#34d399' : 'rgba(255,255,255,0.45)';
            cx.textAlign = 'center';
            cx.textBaseline = 'middle';
            cx.fillText(sa.deg + '\u00B0', lx, ly - 7);
            cx.fillText(sa.rad, lx, ly + 5);

            if (showAllLabels || isCurrent) {
                let coordR = sR + (isCurrent ? 68 : 44);
                let cx2 = sCx + Math.cos(aRad) * coordR;
                let cy2 = sCy - Math.sin(aRad) * coordR;
                cx.font = isCurrent ? '10px Courier New' : '8px Courier New';
                cx.fillStyle = isCurrent ? 'rgba(52,211,153,0.7)' : 'rgba(255,255,255,0.3)';
                cx.fillText('(' + sa.cos + ', ' + sa.sin + ')', cx2, cy2 + (isCurrent ? 16 : 12));
            }
        }
    }

    /* Draw current point with emphasis */
    let cpx = sCx + Math.cos(theta) * sR;
    let cpy = sCy - Math.sin(theta) * sR;
    cx.fillStyle = '#34d399';
    cx.beginPath(); cx.arc(cpx, cpy, 7, 0, Math.PI * 2); cx.fill();
    cx.fillStyle = '#fff';
    cx.beginPath(); cx.arc(cpx, cpy, 3, 0, Math.PI * 2); cx.fill();
}

/* Click on special canvas to set angle */
specCvs.addEventListener('click', e => {
    let r = specCvs.getBoundingClientRect();
    let sx = (e.clientX - r.left) * (SW / r.width);
    let sy = (e.clientY - r.top) * (SH / r.height);
    /* Check if clicked near a special angle */
    for (let sa of specialAngles) {
        let aRad = toRad(sa.deg);
        let px = sCx + Math.cos(aRad) * sR;
        let py = sCy - Math.sin(aRad) * sR;
        let dx = sx - px, dy = sy - py;
        if (dx*dx + dy*dy < 15*15) {
            theta = aRad;
            drawMainCircle();
            drawSpecialCanvas();
            return;
        }
    }
});


/* ══════════════════════════════════════════════════════════════
   SECTION 3: Radians vs Degrees
   ══════════════════════════════════════════════════════════════ */
const radCvs = document.getElementById('radianCanvas');
const radCtx = radCvs.getContext('2d');
const RW = radCvs.width, RH = radCvs.height;

const radSlider = document.getElementById('radianSlider');
let radAngle = Math.PI; // initial

function drawRadianVis() {
    const cx = radCtx;
    cx.clearRect(0, 0, RW, RH);
    cx.fillStyle = '#0a0a1a';
    cx.fillRect(0, 0, RW, RH);

    let circleR = 80;
    let circleCx = 140, circleCy = RH / 2;

    /* Draw the circle */
    cx.strokeStyle = 'rgba(255,255,255,0.12)';
    cx.lineWidth = 1;
    cx.beginPath(); cx.arc(circleCx, circleCy, circleR, 0, Math.PI * 2); cx.stroke();

    /* Axes */
    cx.strokeStyle = 'rgba(255,255,255,0.08)';
    cx.beginPath(); cx.moveTo(circleCx - circleR - 10, circleCy); cx.lineTo(circleCx + circleR + 10, circleCy); cx.stroke();
    cx.beginPath(); cx.moveTo(circleCx, circleCy - circleR - 10); cx.lineTo(circleCx, circleCy + circleR + 10); cx.stroke();

    /* Arc for current angle */
    cx.strokeStyle = '#34d399';
    cx.lineWidth = 3;
    cx.beginPath();
    cx.arc(circleCx, circleCy, circleR, 0, -radAngle, true);
    cx.stroke();

    /* Radius */
    let ex = circleCx + Math.cos(radAngle) * circleR;
    let ey = circleCy - Math.sin(radAngle) * circleR;
    cx.strokeStyle = 'rgba(52,211,153,0.5)';
    cx.lineWidth = 1.5;
    cx.beginPath(); cx.moveTo(circleCx, circleCy); cx.lineTo(ex, ey); cx.stroke();

    /* Point at end */
    cx.fillStyle = '#34d399';
    cx.beginPath(); cx.arc(ex, ey, 4, 0, Math.PI * 2); cx.fill();

    /* Point at start (1,0) */
    cx.fillStyle = '#808098';
    cx.beginPath(); cx.arc(circleCx + circleR, circleCy, 3, 0, Math.PI * 2); cx.fill();

    /* 1 radian mark */
    let oneRadX = circleCx + Math.cos(1) * circleR;
    let oneRadY = circleCy - Math.sin(1) * circleR;
    cx.setLineDash([3, 3]);
    cx.strokeStyle = 'rgba(251,191,36,0.4)';
    cx.lineWidth = 1;
    cx.beginPath(); cx.moveTo(circleCx, circleCy); cx.lineTo(oneRadX, oneRadY); cx.stroke();
    cx.setLineDash([]);
    cx.fillStyle = '#fbbf24';
    cx.beginPath(); cx.arc(oneRadX, oneRadY, 3, 0, Math.PI * 2); cx.fill();
    cx.font = '10px Courier New'; cx.fillStyle = '#fbbf24';
    cx.textAlign = 'left'; cx.textBaseline = 'bottom';
    cx.fillText('1 rad', oneRadX + 5, oneRadY - 3);
    cx.font = '9px Courier New'; cx.fillStyle = 'rgba(251,191,36,0.6)';
    cx.fillText('\u2248 57.3\u00B0', oneRadX + 5, oneRadY + 10);

    /* Unwrapped arc line */
    let lineStartX = 290;
    let lineY = circleCy;
    let totalLineLen = 380;
    let circumference = 2 * Math.PI * circleR; // full pixel circumference
    let pixPerRad = totalLineLen / (2 * Math.PI);

    /* Background line for full circumference */
    cx.strokeStyle = 'rgba(255,255,255,0.08)';
    cx.lineWidth = 1;
    cx.beginPath(); cx.moveTo(lineStartX, lineY); cx.lineTo(lineStartX + totalLineLen, lineY); cx.stroke();

    /* Active arc */
    let arcLen = radAngle * pixPerRad;
    cx.strokeStyle = '#34d399';
    cx.lineWidth = 3;
    cx.beginPath(); cx.moveTo(lineStartX, lineY); cx.lineTo(lineStartX + arcLen, lineY); cx.stroke();

    /* Tick marks on the line */
    let piMarks = [
        {val: Math.PI/6, label: '\u03C0/6'}, {val: Math.PI/4, label: '\u03C0/4'},
        {val: Math.PI/3, label: '\u03C0/3'}, {val: Math.PI/2, label: '\u03C0/2'},
        {val: Math.PI, label: '\u03C0'}, {val: 3*Math.PI/2, label: '3\u03C0/2'},
        {val: 2*Math.PI, label: '2\u03C0'}
    ];
    cx.font = '9px Courier New';
    for (let pm of piMarks) {
        let px = lineStartX + pm.val * pixPerRad;
        cx.strokeStyle = 'rgba(255,255,255,0.15)';
        cx.lineWidth = 1;
        cx.beginPath(); cx.moveTo(px, lineY - 6); cx.lineTo(px, lineY + 6); cx.stroke();
        cx.fillStyle = '#808098';
        cx.textAlign = 'center'; cx.textBaseline = 'top';
        cx.fillText(pm.label, px, lineY + 10);
    }

    /* Degree marks below */
    let degMarks = [{val:90, label:'90\u00B0'}, {val:180, label:'180\u00B0'}, {val:270, label:'270\u00B0'}, {val:360, label:'360\u00B0'}];
    for (let dm of degMarks) {
        let px = lineStartX + toRad(dm.val) * pixPerRad;
        cx.fillStyle = '#505068';
        cx.textAlign = 'center'; cx.textBaseline = 'top';
        cx.fillText(dm.label, px, lineY + 22);
    }

    /* Current angle marker on line */
    let markerX = lineStartX + radAngle * pixPerRad;
    cx.fillStyle = '#34d399';
    cx.beginPath();
    cx.moveTo(markerX, lineY - 10);
    cx.lineTo(markerX - 5, lineY - 18);
    cx.lineTo(markerX + 5, lineY - 18);
    cx.closePath();
    cx.fill();

    /* Labels */
    cx.font = '10px Georgia'; cx.fillStyle = '#808098';
    cx.textAlign = 'center'; cx.textBaseline = 'bottom';
    cx.fillText('Arc length = radius \u00D7 angle', lineStartX + totalLineLen / 2, lineY - 28);
    cx.fillText('On unit circle: arc length = angle in radians', lineStartX + totalLineLen / 2, lineY - 16);

    /* Circumference label */
    cx.font = '10px Courier New'; cx.fillStyle = '#34d399';
    cx.textAlign = 'left'; cx.textBaseline = 'bottom';
    cx.fillText('C = 2\u03C0r = 2\u03C0(1) = 2\u03C0 = 360\u00B0', lineStartX, lineY - 34);

    /* 0 label */
    cx.font = '9px Courier New'; cx.fillStyle = '#808098';
    cx.textAlign = 'center'; cx.textBaseline = 'top';
    cx.fillText('0', lineStartX, lineY + 10);
}

function updateRadianSlider() {
    radAngle = parseInt(radSlider.value) / 1000;
    let deg = toDeg(radAngle);
    document.getElementById('radianSliderLabel').textContent = deg.toFixed(1) + '\u00B0';
    document.getElementById('radianMath').innerHTML =
        '<span class="emerald">' + radAngle.toFixed(3) + ' rad</span> = ' +
        '<span class="muted">' + deg.toFixed(1) + '\u00B0</span> &ensp; ' +
        'Arc length on unit circle = <span class="emerald">' + radAngle.toFixed(3) + '</span>';
    drawRadianVis();
}

radSlider.addEventListener('input', updateRadianSlider);

/* Converter inputs */
let degInput = document.getElementById('degInput');
let radInput = document.getElementById('radInput');

degInput.addEventListener('input', () => {
    let d = parseFloat(degInput.value);
    if (!isNaN(d)) {
        radInput.value = (d * Math.PI / 180).toFixed(5);
    }
});

radInput.addEventListener('input', () => {
    let r = parseFloat(radInput.value);
    if (!isNaN(r)) {
        degInput.value = (r * 180 / Math.PI).toFixed(2);
    }
});


/* ══════════════════════════════════════════════════════════════
   SECTION 4: Trig Function Graphs
   ══════════════════════════════════════════════════════════════ */
const graphCvs = document.getElementById('graphCanvas');
const graphCtx = graphCvs.getContext('2d');
const GW = graphCvs.width, GH = graphCvs.height;

let showSin = true, showCos = true, showTanGraph = false;

/* Build graph toggle buttons */
(function buildGraphBtns() {
    let btns = document.getElementById('graphBtns');
    function render() {
        btns.innerHTML =
            '<button class="btn' + (showSin ? ' active' : '') + '" id="gSin" style="' + (showSin ? 'background:rgba(248,113,113,0.13);border-color:rgba(248,113,113,0.4);color:#f87171' : '') + '">sin \u03B8</button>' +
            '<button class="btn' + (showCos ? ' active' : '') + '" id="gCos" style="' + (showCos ? 'background:rgba(96,165,250,0.13);border-color:rgba(96,165,250,0.4);color:#60a5fa' : '') + '">cos \u03B8</button>' +
            '<button class="btn' + (showTanGraph ? ' active' : '') + '" id="gTan" style="' + (showTanGraph ? 'background:rgba(251,191,36,0.13);border-color:rgba(251,191,36,0.4);color:#fbbf24' : '') + '">tan \u03B8</button>';
        document.getElementById('gSin').addEventListener('click', () => { showSin = !showSin; render(); drawGraph(); });
        document.getElementById('gCos').addEventListener('click', () => { showCos = !showCos; render(); drawGraph(); });
        document.getElementById('gTan').addEventListener('click', () => { showTanGraph = !showTanGraph; render(); drawGraph(); });
    }
    render();
})();

function drawGraph() {
    const cx = graphCtx;
    cx.clearRect(0, 0, GW, GH);
    cx.fillStyle = '#0a0a1a';
    cx.fillRect(0, 0, GW, GH);

    let padL = 40, padR = 20, padT = 20, padB = 40;
    let plotW = GW - padL - padR;
    let plotH = GH - padT - padB;
    let plotCy = padT + plotH / 2;

    /* Horizontal axis (y=0) */
    cx.strokeStyle = 'rgba(255,255,255,0.15)';
    cx.lineWidth = 1;
    cx.beginPath(); cx.moveTo(padL, plotCy); cx.lineTo(padL + plotW, plotCy); cx.stroke();

    /* Vertical axis (x=0) */
    cx.beginPath(); cx.moveTo(padL, padT); cx.lineTo(padL, padT + plotH); cx.stroke();

    /* Y-axis ticks: -1 and 1 */
    cx.font = '10px Courier New'; cx.fillStyle = '#808098';
    cx.textAlign = 'right'; cx.textBaseline = 'middle';
    let y1 = plotCy - plotH / 2 * 0.85; // scale factor
    let yN1 = plotCy + plotH / 2 * 0.85;
    cx.fillText('1', padL - 6, y1);
    cx.fillText('-1', padL - 6, yN1);
    cx.setLineDash([2, 4]);
    cx.strokeStyle = 'rgba(255,255,255,0.06)';
    cx.beginPath(); cx.moveTo(padL, y1); cx.lineTo(padL + plotW, y1); cx.stroke();
    cx.beginPath(); cx.moveTo(padL, yN1); cx.lineTo(padL + plotW, yN1); cx.stroke();
    cx.setLineDash([]);

    /* X-axis ticks */
    let xTicks = [
        {val: Math.PI/2, label: '\u03C0/2'}, {val: Math.PI, label: '\u03C0'},
        {val: 3*Math.PI/2, label: '3\u03C0/2'}, {val: 2*Math.PI, label: '2\u03C0'}
    ];
    cx.textAlign = 'center'; cx.textBaseline = 'top';
    for (let xt of xTicks) {
        let px = padL + (xt.val / (2 * Math.PI)) * plotW;
        cx.fillStyle = '#808098';
        cx.fillText(xt.label, px, plotCy + 6);
        cx.strokeStyle = 'rgba(255,255,255,0.06)';
        cx.setLineDash([2, 4]);
        cx.beginPath(); cx.moveTo(px, padT); cx.lineTo(px, padT + plotH); cx.stroke();
        cx.setLineDash([]);
    }

    let ampScale = plotH / 2 * 0.85;

    function toGraphX(ang) { return padL + (ang / (2 * Math.PI)) * plotW; }
    function toGraphY(v) { return plotCy - v * ampScale; }

    /* Draw tan asymptotes */
    if (showTanGraph) {
        cx.setLineDash([4, 4]);
        cx.strokeStyle = 'rgba(251,191,36,0.2)';
        cx.lineWidth = 1;
        let asymptotes = [Math.PI/2, 3*Math.PI/2];
        for (let a of asymptotes) {
            let px = toGraphX(a);
            cx.beginPath(); cx.moveTo(px, padT); cx.lineTo(px, padT + plotH); cx.stroke();
        }
        cx.setLineDash([]);
    }

    /* Plot functions */
    let step = (2 * Math.PI) / plotW;

    if (showTanGraph) {
        cx.strokeStyle = '#fbbf24';
        cx.lineWidth = 1.5;
        cx.beginPath();
        let started = false;
        for (let a = 0; a <= 2 * Math.PI; a += step) {
            let v = Math.tan(a);
            if (Math.abs(v) > 5) { started = false; continue; }
            let gx = toGraphX(a);
            let gy = toGraphY(v);
            gy = Math.max(padT, Math.min(padT + plotH, gy));
            if (!started) { cx.moveTo(gx, gy); started = true; }
            else cx.lineTo(gx, gy);
        }
        cx.stroke();
    }

    if (showSin) {
        cx.strokeStyle = '#f87171';
        cx.lineWidth = 2;
        cx.beginPath();
        for (let i = 0; i <= plotW; i++) {
            let a = (i / plotW) * 2 * Math.PI;
            let v = Math.sin(a);
            let gx = padL + i;
            let gy = toGraphY(v);
            if (i === 0) cx.moveTo(gx, gy); else cx.lineTo(gx, gy);
        }
        cx.stroke();
    }

    if (showCos) {
        cx.strokeStyle = '#60a5fa';
        cx.lineWidth = 2;
        cx.beginPath();
        for (let i = 0; i <= plotW; i++) {
            let a = (i / plotW) * 2 * Math.PI;
            let v = Math.cos(a);
            let gx = padL + i;
            let gy = toGraphY(v);
            if (i === 0) cx.moveTo(gx, gy); else cx.lineTo(gx, gy);
        }
        cx.stroke();
    }

    /* Vertical marker synchronized with unit circle */
    let na = normAngle(theta);
    let markerX = toGraphX(na);
    cx.strokeStyle = 'rgba(52,211,153,0.6)';
    cx.lineWidth = 1.5;
    cx.beginPath(); cx.moveTo(markerX, padT); cx.lineTo(markerX, padT + plotH); cx.stroke();

    /* Dots on curves at current angle */
    if (showSin) {
        let sy = toGraphY(Math.sin(na));
        cx.fillStyle = '#f87171';
        cx.beginPath(); cx.arc(markerX, sy, 4, 0, Math.PI * 2); cx.fill();
    }
    if (showCos) {
        let cy2 = toGraphY(Math.cos(na));
        cx.fillStyle = '#60a5fa';
        cx.beginPath(); cx.arc(markerX, cy2, 4, 0, Math.PI * 2); cx.fill();
    }
    if (showTanGraph) {
        let tv = Math.tan(na);
        if (Math.abs(tv) < 5) {
            let ty = toGraphY(tv);
            ty = Math.max(padT, Math.min(padT + plotH, ty));
            cx.fillStyle = '#fbbf24';
            cx.beginPath(); cx.arc(markerX, ty, 4, 0, Math.PI * 2); cx.fill();
        }
    }

    /* Info text */
    let info = document.getElementById('graphInfo');
    let parts = [];
    if (showSin) parts.push('<span style="color:#f87171">sin: period = 2\u03C0, amplitude = 1, zeros at 0, \u03C0, 2\u03C0</span>');
    if (showCos) parts.push('<span style="color:#60a5fa">cos: period = 2\u03C0, amplitude = 1, zeros at \u03C0/2, 3\u03C0/2</span>');
    if (showTanGraph) parts.push('<span style="color:#fbbf24">tan: period = \u03C0, asymptotes at \u03C0/2, 3\u03C0/2</span>');
    if (showSin && showCos) parts.push('<span style="color:#808098">Note: cos(\u03B8) = sin(\u03B8 + \u03C0/2) &mdash; cosine is sine shifted left by 90\u00B0</span>');
    info.innerHTML = parts.join('<br>');
}


/* ══════════════════════════════════════════════════════════════
   SECTION 5: Reference Triangles
   ══════════════════════════════════════════════════════════════ */

/* 30-60-90 triangle */
function drawTri3060() {
    const cvs = document.getElementById('tri3060');
    const cx = cvs.getContext('2d');
    const w = cvs.width, h = cvs.height;
    cx.clearRect(0, 0, w, h);
    cx.fillStyle = '#0a0a1a'; cx.fillRect(0, 0, w, h);

    let scale = 70;
    let bx = 40, by = h - 30;

    /* Hypotenuse = 2, adjacent = sqrt(3), opposite = 1 */
    let adj = Math.sqrt(3) * scale; /* sqrt(3) scaled */
    let opp = 1 * scale; /* 1 scaled */

    let ax = bx, ay = by; /* bottom-left */
    let bxx = bx + adj, byy = by; /* bottom-right */
    let cxx = bx + adj, cyy = by - opp; /* top-right */

    /* Fill */
    cx.fillStyle = 'rgba(167,139,250,0.08)';
    cx.beginPath(); cx.moveTo(ax, ay); cx.lineTo(bxx, byy); cx.lineTo(cxx, cyy); cx.closePath(); cx.fill();

    /* Outline */
    cx.strokeStyle = '#a78bfa';
    cx.lineWidth = 2;
    cx.beginPath(); cx.moveTo(ax, ay); cx.lineTo(bxx, byy); cx.lineTo(cxx, cyy); cx.closePath(); cx.stroke();

    /* Right angle mark */
    let rm = 10;
    cx.strokeStyle = 'rgba(255,255,255,0.3)';
    cx.lineWidth = 1;
    cx.beginPath(); cx.moveTo(bxx - rm, byy); cx.lineTo(bxx - rm, byy - rm); cx.lineTo(bxx, byy - rm); cx.stroke();

    /* Labels */
    cx.font = '12px Courier New';

    /* Bottom side: sqrt(3) */
    cx.fillStyle = '#a78bfa'; cx.textAlign = 'center'; cx.textBaseline = 'top';
    cx.fillText('\u221A3', (ax + bxx) / 2, byy + 6);

    /* Right side: 1 */
    cx.fillStyle = '#a78bfa'; cx.textAlign = 'left'; cx.textBaseline = 'middle';
    cx.fillText('1', bxx + 6, (byy + cyy) / 2);

    /* Hypotenuse: 2 */
    cx.fillStyle = '#a78bfa'; cx.textAlign = 'right'; cx.textBaseline = 'bottom';
    cx.save();
    cx.translate((ax + cxx) / 2 - 10, (ay + cyy) / 2);
    let hypAngle = Math.atan2(-(opp), adj);
    cx.rotate(hypAngle);
    cx.fillText('2', 0, -6);
    cx.restore();

    /* Angle labels */
    cx.font = '11px Georgia'; cx.fillStyle = '#808098';
    cx.textAlign = 'left'; cx.textBaseline = 'bottom';
    cx.fillText('30\u00B0', ax + 12, ay - 4);
    cx.textAlign = 'right'; cx.textBaseline = 'top';
    cx.fillText('60\u00B0', cxx - 4, cyy + 14);
}

/* 45-45-90 triangle */
function drawTri4545() {
    const cvs = document.getElementById('tri4545');
    const cx = cvs.getContext('2d');
    const w = cvs.width, h = cvs.height;
    cx.clearRect(0, 0, w, h);
    cx.fillStyle = '#0a0a1a'; cx.fillRect(0, 0, w, h);

    let scale = 90;
    let bx = 40, by = h - 30;

    let ax = bx, ay = by;
    let bxx = bx + scale, byy = by;
    let cxx = bx + scale, cyy = by - scale;

    /* Fill */
    cx.fillStyle = 'rgba(251,191,36,0.08)';
    cx.beginPath(); cx.moveTo(ax, ay); cx.lineTo(bxx, byy); cx.lineTo(cxx, cyy); cx.closePath(); cx.fill();

    /* Outline */
    cx.strokeStyle = '#fbbf24';
    cx.lineWidth = 2;
    cx.beginPath(); cx.moveTo(ax, ay); cx.lineTo(bxx, byy); cx.lineTo(cxx, cyy); cx.closePath(); cx.stroke();

    /* Right angle mark */
    let rm = 10;
    cx.strokeStyle = 'rgba(255,255,255,0.3)';
    cx.lineWidth = 1;
    cx.beginPath(); cx.moveTo(bxx - rm, byy); cx.lineTo(bxx - rm, byy - rm); cx.lineTo(bxx, byy - rm); cx.stroke();

    /* Labels */
    cx.font = '12px Courier New';

    cx.fillStyle = '#fbbf24'; cx.textAlign = 'center'; cx.textBaseline = 'top';
    cx.fillText('1', (ax + bxx) / 2, byy + 6);

    cx.fillStyle = '#fbbf24'; cx.textAlign = 'left'; cx.textBaseline = 'middle';
    cx.fillText('1', bxx + 6, (byy + cyy) / 2);

    cx.fillStyle = '#fbbf24'; cx.textAlign = 'right'; cx.textBaseline = 'bottom';
    cx.save();
    cx.translate((ax + cxx) / 2 - 8, (ay + cyy) / 2);
    cx.rotate(-Math.PI / 4);
    cx.fillText('\u221A2', 0, -6);
    cx.restore();

    /* Angle labels */
    cx.font = '11px Georgia'; cx.fillStyle = '#808098';
    cx.textAlign = 'left'; cx.textBaseline = 'bottom';
    cx.fillText('45\u00B0', ax + 12, ay - 4);
    cx.textAlign = 'right'; cx.textBaseline = 'top';
    cx.fillText('45\u00B0', cxx - 4, cyy + 14);
}

/* Animated reference triangle rotation */
const triAnimCvs = document.getElementById('triAnimCanvas');
const triAnimCtx = triAnimCvs.getContext('2d');
const TAW = triAnimCvs.width, TAH = triAnimCvs.height;
const taCx = TAW/2, taCy = TAH/2, taR = 140;

let triAnimType = '30'; // '30' or '45'
let triAnimAngle = 0; // target base angle
let triAnimCurrent = 0; // current animated angle
let triAnimating = false;
let triAnimTargets = [];
let triAnimIdx = 0;

function drawTriAnim() {
    const cx = triAnimCtx;
    cx.clearRect(0, 0, TAW, TAH);
    cx.fillStyle = '#0a0a1a'; cx.fillRect(0, 0, TAW, TAH);

    /* Axes */
    cx.strokeStyle = 'rgba(255,255,255,0.15)';
    cx.lineWidth = 1;
    cx.beginPath(); cx.moveTo(0, taCy); cx.lineTo(TAW, taCy); cx.stroke();
    cx.beginPath(); cx.moveTo(taCx, 0); cx.lineTo(taCx, TAH); cx.stroke();

    /* Unit circle */
    cx.strokeStyle = 'rgba(255,255,255,0.1)';
    cx.beginPath(); cx.arc(taCx, taCy, taR, 0, Math.PI * 2); cx.stroke();

    /* Quadrant labels */
    cx.font = '11px Georgia'; cx.fillStyle = 'rgba(255,255,255,0.08)';
    cx.textAlign = 'center'; cx.textBaseline = 'middle';
    cx.fillText('Q I', taCx + taR/2, taCy - taR/2);
    cx.fillText('Q II', taCx - taR/2, taCy - taR/2);
    cx.fillText('Q III', taCx - taR/2, taCy + taR/2);
    cx.fillText('Q IV', taCx + taR/2, taCy + taR/2);

    /* Reference angle for the triangle type */
    let refAngle = triAnimType === '30' ? Math.PI/6 : Math.PI/4;
    let baseAngle = triAnimCurrent;

    /* The triangle: from origin to point on circle */
    let fullAngle = baseAngle + refAngle;
    let px = taCx + Math.cos(fullAngle) * taR;
    let py = taCy - Math.sin(fullAngle) * taR;
    let footX = px; /* foot of the vertical from P to x-axis... actually from P to the x-axis */
    let footY = taCy;

    /* Triangle fill */
    cx.fillStyle = 'rgba(52,211,153,0.08)';
    cx.beginPath();
    cx.moveTo(taCx, taCy);
    cx.lineTo(footX, footY);
    cx.lineTo(px, py);
    cx.closePath();
    cx.fill();

    /* Triangle outline */
    cx.strokeStyle = '#34d399';
    cx.lineWidth = 2;
    cx.beginPath();
    cx.moveTo(taCx, taCy);
    cx.lineTo(footX, footY);
    cx.lineTo(px, py);
    cx.closePath();
    cx.stroke();

    /* Right angle mark at foot */
    let rm = 8;
    let dir = Math.cos(fullAngle) >= 0 ? -1 : 1;
    let dirY = Math.sin(fullAngle) >= 0 ? 1 : -1;
    cx.strokeStyle = 'rgba(255,255,255,0.3)';
    cx.lineWidth = 1;
    cx.beginPath();
    cx.moveTo(footX + dir * rm, footY);
    cx.lineTo(footX + dir * rm, footY - dirY * rm);
    cx.lineTo(footX, footY - dirY * rm);
    cx.stroke();

    /* Radius line (hypotenuse) */
    cx.strokeStyle = 'rgba(52,211,153,0.6)';
    cx.lineWidth = 1.5;
    cx.beginPath(); cx.moveTo(taCx, taCy); cx.lineTo(px, py); cx.stroke();

    /* Point */
    cx.fillStyle = '#34d399';
    cx.beginPath(); cx.arc(px, py, 5, 0, Math.PI * 2); cx.fill();

    /* Labels on sides */
    let cosV = Math.cos(fullAngle);
    let sinV = Math.sin(fullAngle);
    cx.font = '11px Courier New';

    /* cos label on horizontal */
    cx.fillStyle = '#60a5fa'; cx.textAlign = 'center'; cx.textBaseline = sinV >= 0 ? 'top' : 'bottom';
    cx.fillText('cos=' + cosV.toFixed(3), (taCx + footX) / 2, taCy + (sinV >= 0 ? 8 : -8));

    /* sin label on vertical */
    cx.fillStyle = '#f87171'; cx.textAlign = cosV >= 0 ? 'left' : 'right'; cx.textBaseline = 'middle';
    cx.fillText('sin=' + sinV.toFixed(3), footX + (cosV >= 0 ? 6 : -6), (footY + py) / 2);

    /* Angle arc */
    cx.strokeStyle = 'rgba(52,211,153,0.5)';
    cx.lineWidth = 1.5;
    cx.beginPath();
    cx.arc(taCx, taCy, 20, 0, -fullAngle, fullAngle > 0);
    cx.stroke();

    /* Info */
    let q = getQuadrant(fullAngle);
    let degV = toDeg(normAngle(fullAngle));
    document.getElementById('triAnimInfo').innerHTML =
        '<span class="emerald">Angle: ' + degV.toFixed(0) + '\u00B0</span> &ensp; Quadrant ' + ['','I','II','III','IV'][q] +
        ' &ensp; sin: <span class="' + (sinV >= 0 ? 'sign-pos' : 'sign-neg') + '">' + (sinV >= 0 ? '+' : '-') + '</span>' +
        ' &ensp; cos: <span class="' + (cosV >= 0 ? 'sign-pos' : 'sign-neg') + '">' + (cosV >= 0 ? '+' : '-') + '</span>' +
        ' &ensp; tan: <span class="' + ((sinV >= 0) === (cosV >= 0) ? 'sign-pos' : 'sign-neg') + '">' + ((sinV >= 0) === (cosV >= 0) ? '+' : '-') + '</span>' +
        '<br><span style="color:#808098">The reference triangle keeps the same shape &mdash; only the signs change across quadrants.</span>';
}

function animateTriangle(type) {
    if (triAnimating) return;
    triAnimType = type;
    let refAngle = type === '30' ? 30 : 45;
    triAnimTargets = [0, 180 - refAngle, 180 + refAngle, 360 - refAngle].map(d => toRad(d));
    triAnimIdx = 0;
    triAnimCurrent = 0;
    triAnimating = true;
    animNextTarget();
}

function animNextTarget() {
    if (triAnimIdx >= triAnimTargets.length) {
        triAnimating = false;
        return;
    }
    let target = triAnimTargets[triAnimIdx];
    let start = triAnimCurrent;
    let t0 = performance.now();
    let duration = 600;

    function step(now) {
        let frac = Math.min(1, (now - t0) / duration);
        /* ease in-out */
        frac = frac < 0.5 ? 2 * frac * frac : 1 - Math.pow(-2 * frac + 2, 2) / 2;
        triAnimCurrent = start + (target - start) * frac;
        drawTriAnim();
        if (frac < 1) {
            requestAnimationFrame(step);
        } else {
            triAnimCurrent = target;
            triAnimIdx++;
            setTimeout(animNextTarget, 400);
        }
    }
    requestAnimationFrame(step);
}

document.getElementById('animTriBtn30').addEventListener('click', () => animateTriangle('30'));
document.getElementById('animTriBtn45').addEventListener('click', () => animateTriangle('45'));


/* ══════════════════════════════════════════════════════════════
   Initial draws
   ══════════════════════════════════════════════════════════════ */
drawMainCircle();
drawSpecialCanvas();
updateRadianSlider();
drawGraph();
drawTri3060();
drawTri4545();
drawTriAnim();
</script>
<footer style="text-align:center;padding:28px 20px 18px;color:#505068;font-size:0.72em;line-height:1.7;border-top:1px solid rgba(255,255,255,0.04);margin-top:30px"><div>&copy; 2025&ndash;2026 Manoj Bhaskar &middot; Coded by <a href="https://claude.ai/claude-code" style="color:#606078;text-decoration:none" target="_blank" rel="noopener">Claude</a> &middot; <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" style="color:#606078;text-decoration:none" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a></div></footer>
</body>
</html>
